import{S as t,i as s,s as e,a1 as a,j as n,k as r,m as $,n as o,o as c,f as i,O as f,v as l,r as p,w as u,d as m,I as d,a2 as g,ak as h,al as v,K as w,E as x,F as k,G as y,am as b,e as j,c as E,a as I,b as P,A as T,t as _,g as z,af as G,ac as C,a4 as D,B as K,u as R,p as S,U as V}from"../chunks/vendor-c4839857.js";import{a as A}from"../chunks/api-5c0c9630.js";import{I as B}from"../chunks/Input-7298b594.js";import{g as F}from"../chunks/navigation-20968cc5.js";import{n as L}from"../chunks/stores-7d091ba3.js";import{p as O}from"../chunks/post-5b27026c.js";import"../chunks/singletons-bb9012b7.js";function U(t){let s,e,a,f,d,g,h;function v(s){t[7](s)}function w(s){t[8](s)}let b={invalidText:t[2],labelText:"Password",password:!0,focus:!0};function j(s){t[9](s)}void 0!==t[3]&&(b.invalid=t[3]),void 0!==t[1]&&(b.value=t[1]),s=new B({props:b}),x.push((()=>k(s,"invalid",v))),x.push((()=>k(s,"value",w)));let E={labelText:"Password",password:!0};return void 0!==t[0]&&(E.value=t[0]),d=new B({props:E}),x.push((()=>k(d,"value",j))),{c(){n(s.$$.fragment),f=r(),n(d.$$.fragment)},l(t){$(s.$$.fragment,t),f=o(t),$(d.$$.fragment,t)},m(t,e){c(s,t,e),i(t,f,e),c(d,t,e),h=!0},p(t,n){const r={};4&n&&(r.invalidText=t[2]),!e&&8&n&&(e=!0,r.invalid=t[3],y((()=>e=!1))),!a&&2&n&&(a=!0,r.value=t[1],y((()=>a=!1))),s.$set(r);const $={};!g&&1&n&&(g=!0,$.value=t[0],y((()=>g=!1))),d.$set($)},i(t){h||(l(s.$$.fragment,t),l(d.$$.fragment,t),h=!0)},o(t){p(s.$$.fragment,t),p(d.$$.fragment,t),h=!1},d(t){u(s,t),t&&m(f),u(d,t)}}}function q(t){let s,e;return s=new h({props:{$$slots:{default:[U]},$$scope:{ctx:t}}}),{c(){n(s.$$.fragment)},l(t){$(s.$$.fragment,t)},m(t,a){c(s,t,a),e=!0},p(t,e){const a={};4111&e&&(a.$$scope={dirty:e,ctx:t}),s.$set(a)},i(t){e||(l(s.$$.fragment,t),e=!0)},o(t){p(s.$$.fragment,t),e=!1},d(t){u(s,t)}}}function H(t){let s,e;return s=new g({props:{$$slots:{default:[q]},$$scope:{ctx:t}}}),{c(){n(s.$$.fragment)},l(t){$(s.$$.fragment,t)},m(t,a){c(s,t,a),e=!0},p(t,e){const a={};4111&e&&(a.$$scope={dirty:e,ctx:t}),s.$set(a)},i(t){e||(l(s.$$.fragment,t),e=!0)},o(t){p(s.$$.fragment,t),e=!1},d(t){u(s,t)}}}function J(t){let s,e,a;return e=new V({}),{c(){s=j("div"),n(e.$$.fragment),this.h()},l(t){s=E(t,"DIV",{class:!0});var a=I(s);$(e.$$.fragment,a),a.forEach(m),this.h()},h(){P(s,"class","right svelte-pb9zr2")},m(t,n){i(t,s,n),c(e,s,null),a=!0},i(t){a||(l(e.$$.fragment,t),a=!0)},o(t){p(e.$$.fragment,t),a=!1},d(t){t&&m(s),u(e)}}}function M(t){let s,e,a,n,$,c,u,d=t[4]&&J(),g=[t[11]],h={};for(let r=0;r<g.length;r+=1)h=T(h,g[r]);return{c(){s=j("div"),e=j("p"),a=_("Reset"),n=r(),d&&d.c(),this.h()},l(t){s=E(t,"DIV",{});var r=I(s);e=E(r,"P",{});var $=I(e);a=z($,"Reset"),$.forEach(m),n=o(r),d&&d.l(r),r.forEach(m),this.h()},h(){G(s,h),C(s,"svelte-pb9zr2",!0)},m(r,o){i(r,s,o),D(s,e),D(e,a),D(s,n),d&&d.m(s,null),$=!0,c||(u=f(s,"click",t[6]),c=!0)},p(t,e){t[4]?d?16&e&&l(d,1):(d=J(),d.c(),l(d,1),d.m(s,null)):d&&(K(),p(d,1,1,(()=>{d=null})),R()),G(s,h=S(g,[2048&e&&t[11]])),C(s,"svelte-pb9zr2",!0)},i(t){$||(l(d),$=!0)},o(t){p(d),$=!1},d(t){t&&m(s),d&&d.d(),c=!1,u()}}}function N(t){let s,e;return s=new b({props:{as:!0,$$slots:{default:[M,({props:t})=>({11:t}),({props:t})=>t?2048:0]},$$scope:{ctx:t}}}),{c(){n(s.$$.fragment)},l(t){$(s.$$.fragment,t)},m(t,a){c(s,t,a),e=!0},p(t,e){const a={};6160&e&&(a.$$scope={dirty:e,ctx:t}),s.$set(a)},i(t){e||(l(s.$$.fragment,t),e=!0)},o(t){p(s.$$.fragment,t),e=!1},d(t){u(s,t)}}}function Q(t){let s,e;return s=new v({props:{stacked:!0,$$slots:{default:[N]},$$scope:{ctx:t}}}),{c(){n(s.$$.fragment)},l(t){$(s.$$.fragment,t)},m(t,a){c(s,t,a),e=!0},p(t,e){const a={};4112&e&&(a.$$scope={dirty:e,ctx:t}),s.$set(a)},i(t){e||(l(s.$$.fragment,t),e=!0)},o(t){p(s.$$.fragment,t),e=!1},d(t){u(s,t)}}}function W(t){let s,e;return s=new g({props:{$$slots:{default:[Q]},$$scope:{ctx:t}}}),{c(){n(s.$$.fragment)},l(t){$(s.$$.fragment,t)},m(t,a){c(s,t,a),e=!0},p(t,e){const a={};4112&e&&(a.$$scope={dirty:e,ctx:t}),s.$set(a)},i(t){e||(l(s.$$.fragment,t),e=!0)},o(t){p(s.$$.fragment,t),e=!1},d(t){u(s,t)}}}function X(t){let s,e,d,g,h,v;return s=new a({props:{noGutter:!0,$$slots:{default:[H]},$$scope:{ctx:t}}}),d=new a({props:{noGutter:!0,$$slots:{default:[W]},$$scope:{ctx:t}}}),{c(){n(s.$$.fragment),e=r(),n(d.$$.fragment)},l(t){$(s.$$.fragment,t),e=o(t),$(d.$$.fragment,t)},m(a,n){c(s,a,n),i(a,e,n),c(d,a,n),g=!0,h||(v=f(window,"keydown",t[5]),h=!0)},p(t,[e]){const a={};4111&e&&(a.$$scope={dirty:e,ctx:t}),s.$set(a);const n={};4112&e&&(n.$$scope={dirty:e,ctx:t}),d.$set(n)},i(t){g||(l(s.$$.fragment,t),l(d.$$.fragment,t),g=!0)},o(t){p(s.$$.fragment,t),p(d.$$.fragment,t),g=!1},d(t){u(s,t),t&&m(e),u(d,t),h=!1,v()}}}async function Y(){if(!(await A.get("check_reset_password_token")).r)return{status:302,redirect:"login?n=invalid"}}function Z(t,s,e){let a,n,r,$,o,c;d(t,L,(t=>e(10,a=t)));return[n,r,$,o,c,t=>{if(t.ctrlKey)switch(t.keyCode){case 13:join()}else switch(t.keyCode){case 13:login()}},async()=>{if(e(4,c=!0),!r)return e(3,o=!0),e(2,$="Empty"),void e(4,c=!1);if(r!==n)return e(3,o=!0),e(2,$="Passwords do not match"),void e(4,c=!1);(await A.put("reset_password",{password:n}).finally((t=>(e(4,c=!1),t)))).r?(w(L,a="resetSuccess",a),await O("auth/login",{username:username,password:n}),F("/")):(w(L,a="invalidLink",a),F("/login"))},function(t){o=t,e(3,o)},function(t){r=t,e(1,r)},function(t){n=t,e(0,n)}]}export default class extends t{constructor(t){super(),s(this,t,Z,X,e,{})}}export{Y as load};
