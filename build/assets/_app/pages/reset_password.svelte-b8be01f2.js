import{S as t,i as s,s as e,a5 as a,j as n,k as r,m as $,n as o,o as c,f as i,O as f,x as l,u as p,v as u,d as m,I as d,a6 as g,aC as h,aD as v,K as w,E as x,F as k,G as y,aq as j,e as b,c as E,a as I,b as P,B as T,t as _,g as q,al as z,aj as C,a8 as D,r as G,w as K,p as R,U as S}from"../chunks/vendor-c7b4d8a9.js";import{g as V,p as B}from"../chunks/api-eadfccdc.js";import{I as F}from"../chunks/Input-8c5d8c16.js";import{g as L}from"../chunks/navigation-51f4a605.js";import{n as O}from"../chunks/stores-fc5807c6.js";import{p as U}from"../chunks/utils-80e4c2bc.js";import"../chunks/singletons-12a22614.js";function A(t){let s,e,a,f,d,g,h;function v(s){t[8](s)}function w(s){t[9](s)}let j={invalidText:t[2],labelText:"Password",password:!0,focus:!0};function b(s){t[10](s)}void 0!==t[3]&&(j.invalid=t[3]),void 0!==t[1]&&(j.value=t[1]),s=new F({props:j}),x.push((()=>k(s,"invalid",v))),x.push((()=>k(s,"value",w)));let E={labelText:"Password",password:!0};return void 0!==t[0]&&(E.value=t[0]),d=new F({props:E}),x.push((()=>k(d,"value",b))),{c(){n(s.$$.fragment),f=r(),n(d.$$.fragment)},l(t){$(s.$$.fragment,t),f=o(t),$(d.$$.fragment,t)},m(t,e){c(s,t,e),i(t,f,e),c(d,t,e),h=!0},p(t,n){const r={};4&n&&(r.invalidText=t[2]),!e&&8&n&&(e=!0,r.invalid=t[3],y((()=>e=!1))),!a&&2&n&&(a=!0,r.value=t[1],y((()=>a=!1))),s.$set(r);const $={};!g&&1&n&&(g=!0,$.value=t[0],y((()=>g=!1))),d.$set($)},i(t){h||(l(s.$$.fragment,t),l(d.$$.fragment,t),h=!0)},o(t){p(s.$$.fragment,t),p(d.$$.fragment,t),h=!1},d(t){u(s,t),t&&m(f),u(d,t)}}}function H(t){let s,e;return s=new h({props:{$$slots:{default:[A]},$$scope:{ctx:t}}}),{c(){n(s.$$.fragment)},l(t){$(s.$$.fragment,t)},m(t,a){c(s,t,a),e=!0},p(t,e){const a={};8207&e&&(a.$$scope={dirty:e,ctx:t}),s.$set(a)},i(t){e||(l(s.$$.fragment,t),e=!0)},o(t){p(s.$$.fragment,t),e=!1},d(t){u(s,t)}}}function J(t){let s,e;return s=new g({props:{$$slots:{default:[H]},$$scope:{ctx:t}}}),{c(){n(s.$$.fragment)},l(t){$(s.$$.fragment,t)},m(t,a){c(s,t,a),e=!0},p(t,e){const a={};8207&e&&(a.$$scope={dirty:e,ctx:t}),s.$set(a)},i(t){e||(l(s.$$.fragment,t),e=!0)},o(t){p(s.$$.fragment,t),e=!1},d(t){u(s,t)}}}function M(t){let s,e,a;return e=new S({}),{c(){s=b("div"),n(e.$$.fragment),this.h()},l(t){s=E(t,"DIV",{class:!0});var a=I(s);$(e.$$.fragment,a),a.forEach(m),this.h()},h(){P(s,"class","right svelte-pb9zr2")},m(t,n){i(t,s,n),c(e,s,null),a=!0},i(t){a||(l(e.$$.fragment,t),a=!0)},o(t){p(e.$$.fragment,t),a=!1},d(t){t&&m(s),u(e)}}}function N(t){let s,e,a,n,$,c,u,d=t[4]&&M(),g=[t[12]],h={};for(let r=0;r<g.length;r+=1)h=T(h,g[r]);return{c(){s=b("div"),e=b("p"),a=_("Reset"),n=r(),d&&d.c(),this.h()},l(t){s=E(t,"DIV",{});var r=I(s);e=E(r,"P",{});var $=I(e);a=q($,"Reset"),$.forEach(m),n=o(r),d&&d.l(r),r.forEach(m),this.h()},h(){z(s,h),C(s,"svelte-pb9zr2",!0)},m(r,o){i(r,s,o),D(s,e),D(e,a),D(s,n),d&&d.m(s,null),$=!0,c||(u=f(s,"click",t[6]),c=!0)},p(t,e){t[4]?d?16&e&&l(d,1):(d=M(),d.c(),l(d,1),d.m(s,null)):d&&(G(),p(d,1,1,(()=>{d=null})),K()),z(s,h=R(g,[4096&e&&t[12]])),C(s,"svelte-pb9zr2",!0)},i(t){$||(l(d),$=!0)},o(t){p(d),$=!1},d(t){t&&m(s),d&&d.d(),c=!1,u()}}}function Q(t){let s,e;return s=new j({props:{as:!0,$$slots:{default:[N,({props:t})=>({12:t}),({props:t})=>t?4096:0]},$$scope:{ctx:t}}}),{c(){n(s.$$.fragment)},l(t){$(s.$$.fragment,t)},m(t,a){c(s,t,a),e=!0},p(t,e){const a={};12304&e&&(a.$$scope={dirty:e,ctx:t}),s.$set(a)},i(t){e||(l(s.$$.fragment,t),e=!0)},o(t){p(s.$$.fragment,t),e=!1},d(t){u(s,t)}}}function W(t){let s,e;return s=new v({props:{stacked:!0,$$slots:{default:[Q]},$$scope:{ctx:t}}}),{c(){n(s.$$.fragment)},l(t){$(s.$$.fragment,t)},m(t,a){c(s,t,a),e=!0},p(t,e){const a={};8208&e&&(a.$$scope={dirty:e,ctx:t}),s.$set(a)},i(t){e||(l(s.$$.fragment,t),e=!0)},o(t){p(s.$$.fragment,t),e=!1},d(t){u(s,t)}}}function X(t){let s,e;return s=new g({props:{$$slots:{default:[W]},$$scope:{ctx:t}}}),{c(){n(s.$$.fragment)},l(t){$(s.$$.fragment,t)},m(t,a){c(s,t,a),e=!0},p(t,e){const a={};8208&e&&(a.$$scope={dirty:e,ctx:t}),s.$set(a)},i(t){e||(l(s.$$.fragment,t),e=!0)},o(t){p(s.$$.fragment,t),e=!1},d(t){u(s,t)}}}function Y(t){let s,e,d,g,h,v;return s=new a({props:{noGutter:!0,$$slots:{default:[J]},$$scope:{ctx:t}}}),d=new a({props:{noGutter:!0,$$slots:{default:[X]},$$scope:{ctx:t}}}),{c(){n(s.$$.fragment),e=r(),n(d.$$.fragment)},l(t){$(s.$$.fragment,t),e=o(t),$(d.$$.fragment,t)},m(a,n){c(s,a,n),i(a,e,n),c(d,a,n),g=!0,h||(v=f(window,"keydown",t[5]),h=!0)},p(t,[e]){const a={};8207&e&&(a.$$scope={dirty:e,ctx:t}),s.$set(a);const n={};8208&e&&(n.$$scope={dirty:e,ctx:t}),d.$set(n)},i(t){g||(l(s.$$.fragment,t),l(d.$$.fragment,t),g=!0)},o(t){p(s.$$.fragment,t),p(d.$$.fragment,t),g=!1},d(t){u(s,t),t&&m(e),u(d,t),h=!1,v()}}}async function Z({page:t}){let s=t.query.q;if(!(await V("check_reset_password_token",s)).r)return{status:302,redirect:"login?n=invalid"}}function tt(t,s,e){let a;d(t,O,(t=>e(11,a=t)));let n,r,$,o,c,{token:i}=s;return t.$$set=t=>{"token"in t&&e(7,i=t.token)},[n,r,$,o,c,t=>{if(t.ctrlKey)switch(t.keyCode){case 13:join()}else switch(t.keyCode){case 13:login()}},async()=>{if(e(4,c=!0),!r)return e(3,o=!0),e(2,$="Empty"),void e(4,c=!1);if(r!==n)return e(3,o=!0),e(2,$="Passwords do not match"),void e(4,c=!1);(await B("reset_password",{password:n},i).finally((t=>(e(4,c=!1),t)))).r?(w(O,a="resetSuccess",a),await U("auth/login",{username:username,password:n}),L("/")):(w(O,a="invalidLink",a),L("/login"))},i,function(t){o=t,e(3,o)},function(t){r=t,e(1,r)},function(t){n=t,e(0,n)}]}class st extends t{constructor(t){super(),s(this,t,tt,Y,e,{token:7})}}export{st as default,Z as load};
