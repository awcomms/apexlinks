import{S as t,i as e,s as n,a9 as $,E as s,F as a,a5 as r,j as o,k as i,m as c,n as f,ab as m,d as l,o as u,f as p,O as d,G as g,x as h,u as v,v as x,a6 as k,aD as w,e as y,t as b,c as T,a as j,g as E,a8 as I,aE as D,aC as G,aq as F,aA as C,l as N,r as S,w as A,aF as B}from"../../chunks/vendor-c7b4d8a9.js";import{g as H,d as L,p as q}from"../../chunks/api-eadfccdc.js";import{g as K}from"../../chunks/navigation-51f4a605.js";import{i as M,b as O}from"../../chunks/utils-80e4c2bc.js";import{T as P}from"../../chunks/Tag-6c3f4b89.js";import{I as z}from"../../chunks/Image-64a8c94e.js";import{F as J}from"../../chunks/Fields-fc88a2b6.js";import{I as Q}from"../../chunks/Input-8c5d8c16.js";import"../../chunks/singletons-12a22614.js";function R(t){let e,n;return{c(){e=y("p"),n=b("Sure you want to delete this item?")},l(t){e=T(t,"P",{});var $=j(e);n=E($,"Sure you want to delete this item?"),$.forEach(l)},m(t,$){p(t,e,$),I(e,n)},d(t){t&&l(e)}}}function U(t){let e,n,$;function r(e){t[23](e)}let i={labelText:"Hidden"};return void 0!==t[4]&&(i.checked=t[4]),e=new D({props:i}),s.push((()=>a(e,"checked",r))),{c(){o(e.$$.fragment)},l(t){c(e.$$.fragment,t)},m(t,n){u(e,t,n),$=!0},p(t,$){const s={};!n&&16&$[0]&&(n=!0,s.checked=t[4],g((()=>n=!1))),e.$set(s)},i(t){$||(h(e.$$.fragment,t),$=!0)},o(t){v(e.$$.fragment,t),$=!1},d(t){x(e,t)}}}function V(t){let e,n;return e=new k({props:{$$slots:{default:[U]},$$scope:{ctx:t}}}),{c(){o(e.$$.fragment)},l(t){c(e.$$.fragment,t)},m(t,$){u(e,t,$),n=!0},p(t,n){const $={};16&n[0]|512&n[1]&&($.$$scope={dirty:n,ctx:t}),e.$set($)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){v(e.$$.fragment,t),n=!1},d(t){x(e,t)}}}function W(t){let e,n,$;function r(e){t[25](e)}let i={pin:!0};return void 0!==t[8]&&(i.fields=t[8]),e=new J({props:i}),s.push((()=>a(e,"fields",r))),{c(){o(e.$$.fragment)},l(t){c(e.$$.fragment,t)},m(t,n){u(e,t,n),$=!0},p(t,$){const s={};!n&&256&$[0]&&(n=!0,s.fields=t[8],g((()=>n=!1))),e.$set(s)},i(t){$||(h(e.$$.fragment,t),$=!0)},o(t){v(e.$$.fragment,t),$=!1},d(t){x(e,t)}}}function X(t){let e,n;return e=new k({props:{$$slots:{default:[W]},$$scope:{ctx:t}}}),{c(){o(e.$$.fragment)},l(t){c(e.$$.fragment,t)},m(t,$){u(e,t,$),n=!0},p(t,n){const $={};256&n[0]|512&n[1]&&($.$$scope={dirty:n,ctx:t}),e.$set($)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){v(e.$$.fragment,t),n=!1},d(t){x(e,t)}}}function Y(t){let e,n,$,r;function i(e){t[26](e)}function f(e){t[27](e)}let m={labelText:"Name",invalidText:"Name taken"};return void 0!==t[9]&&(m.value=t[9]),void 0!==t[2]&&(m.invalid=t[2]),e=new Q({props:m}),s.push((()=>a(e,"value",i))),s.push((()=>a(e,"invalid",f))),{c(){o(e.$$.fragment)},l(t){c(e.$$.fragment,t)},m(t,n){u(e,t,n),r=!0},p(t,s){const a={};!n&&512&s[0]&&(n=!0,a.value=t[9],g((()=>n=!1))),!$&&4&s[0]&&($=!0,a.invalid=t[2],g((()=>$=!1))),e.$set(a)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){x(e,t)}}}function Z(t){let e,n,$;function r(e){t[35](e)}let i={placeholder:"Description(Markdown)"};return void 0!==t[3]&&(i.value=t[3]),e=new B({props:i}),s.push((()=>a(e,"value",r))),{c(){o(e.$$.fragment)},l(t){c(e.$$.fragment,t)},m(t,n){u(e,t,n),$=!0},p(t,$){const s={};!n&&8&$[0]&&(n=!0,s.value=t[3],g((()=>n=!1))),e.$set(s)},i(t){$||(h(e.$$.fragment,t),$=!0)},o(t){v(e.$$.fragment,t),$=!1},d(t){x(e,t)}}}function _(t){let e,n,$,r,i,f;function m(e){t[30](e)}function l(e){t[31](e)}function p(e){t[32](e)}function d(e){t[33](e)}let k={labelText:"Link"};return void 0!==t[1]&&(k.invalid=t[1]),void 0!==t[12]&&(k.invalidText=t[12]),void 0!==t[6]&&(k.value=t[6]),void 0!==t[11]&&(k.ref=t[11]),e=new Q({props:k}),s.push((()=>a(e,"invalid",m))),s.push((()=>a(e,"invalidText",l))),s.push((()=>a(e,"value",p))),s.push((()=>a(e,"ref",d))),e.$on("input",t[34]),{c(){o(e.$$.fragment)},l(t){c(e.$$.fragment,t)},m(t,n){u(e,t,n),f=!0},p(t,s){const a={};!n&&2&s[0]&&(n=!0,a.invalid=t[1],g((()=>n=!1))),!$&&4096&s[0]&&($=!0,a.invalidText=t[12],g((()=>$=!1))),!r&&64&s[0]&&(r=!0,a.value=t[6],g((()=>r=!1))),!i&&2048&s[0]&&(i=!0,a.ref=t[11],g((()=>i=!1))),e.$set(a)},i(t){f||(h(e.$$.fragment,t),f=!0)},o(t){v(e.$$.fragment,t),f=!1},d(t){x(e,t)}}}function tt(t){let e,n,$,r,m,d,k,w,y,b;function T(e){t[28](e)}let j={labelText:"Item type"};function E(e){t[29](e)}void 0!==t[0]&&(j.value=t[0]),e=new C({props:j}),s.push((()=>a(e,"value",T)));let I={labelText:"Let the item's listing redirect to a link"};void 0!==t[5]&&(I.checked=t[5]),r=new D({props:I}),s.push((()=>a(r,"checked",E)));const G=[_,Z],F=[];function B(t,e){return t[5]?0:1}return k=B(t),w=F[k]=G[k](t),{c(){o(e.$$.fragment),$=i(),o(r.$$.fragment),d=i(),w.c(),y=N()},l(t){c(e.$$.fragment,t),$=f(t),c(r.$$.fragment,t),d=f(t),w.l(t),y=N()},m(t,n){u(e,t,n),p(t,$,n),u(r,t,n),p(t,d,n),F[k].m(t,n),p(t,y,n),b=!0},p(t,$){const s={};!n&&1&$[0]&&(n=!0,s.value=t[0],g((()=>n=!1))),e.$set(s);const a={};!m&&32&$[0]&&(m=!0,a.checked=t[5],g((()=>m=!1))),r.$set(a);let o=k;k=B(t),k===o?F[k].p(t,$):(S(),v(F[o],1,1,(()=>{F[o]=null})),A(),w=F[k],w?w.p(t,$):(w=F[k]=G[k](t),w.c()),h(w,1),w.m(y.parentNode,y))},i(t){b||(h(e.$$.fragment,t),h(r.$$.fragment,t),h(w),b=!0)},o(t){v(e.$$.fragment,t),v(r.$$.fragment,t),v(w),b=!1},d(t){x(e,t),t&&l($),x(r,t),t&&l(d),F[k].d(t),t&&l(y)}}}function et(t){let e,n,$,s;return e=new G({props:{$$slots:{default:[Y]},$$scope:{ctx:t}}}),$=new G({props:{$$slots:{default:[tt]},$$scope:{ctx:t}}}),{c(){o(e.$$.fragment),n=i(),o($.$$.fragment)},l(t){c(e.$$.fragment,t),n=f(t),c($.$$.fragment,t)},m(t,a){u(e,t,a),p(t,n,a),u($,t,a),s=!0},p(t,n){const s={};516&n[0]|512&n[1]&&(s.$$scope={dirty:n,ctx:t}),e.$set(s);const a={};6251&n[0]|512&n[1]&&(a.$$scope={dirty:n,ctx:t}),$.$set(a)},i(t){s||(h(e.$$.fragment,t),h($.$$.fragment,t),s=!0)},o(t){v(e.$$.fragment,t),v($.$$.fragment,t),s=!1},d(t){x(e,t),t&&l(n),x($,t)}}}function nt(t){let e,n;return e=new k({props:{$$slots:{default:[et]},$$scope:{ctx:t}}}),{c(){o(e.$$.fragment)},l(t){c(e.$$.fragment,t)},m(t,$){u(e,t,$),n=!0},p(t,n){const $={};6767&n[0]|512&n[1]&&($.$$scope={dirty:n,ctx:t}),e.$set($)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){v(e.$$.fragment,t),n=!1},d(t){x(e,t)}}}function $t(t){let e;return{c(){e=b("Delete Item")},l(t){e=E(t,"Delete Item")},m(t,n){p(t,e,n)},d(t){t&&l(e)}}}function st(t){let e;return{c(){e=b("Edit")},l(t){e=E(t,"Edit")},m(t,n){p(t,e,n)},d(t){t&&l(e)}}}function at(t){let e,n,$,s;return e=new F({props:{$$slots:{default:[$t]},$$scope:{ctx:t}}}),e.$on("click",t[36]),$=new F({props:{$$slots:{default:[st]},$$scope:{ctx:t}}}),$.$on("click",t[16]),{c(){o(e.$$.fragment),n=i(),o($.$$.fragment)},l(t){c(e.$$.fragment,t),n=f(t),c($.$$.fragment,t)},m(t,a){u(e,t,a),p(t,n,a),u($,t,a),s=!0},p(t,n){const s={};512&n[1]&&(s.$$scope={dirty:n,ctx:t}),e.$set(s);const a={};512&n[1]&&(a.$$scope={dirty:n,ctx:t}),$.$set(a)},i(t){s||(h(e.$$.fragment,t),h($.$$.fragment,t),s=!0)},o(t){v(e.$$.fragment,t),v($.$$.fragment,t),s=!1},d(t){x(e,t),t&&l(n),x($,t)}}}function rt(t){let e,n;return e=new w({props:{stacked:!0,$$slots:{default:[at]},$$scope:{ctx:t}}}),{c(){o(e.$$.fragment)},l(t){c(e.$$.fragment,t)},m(t,$){u(e,t,$),n=!0},p(t,n){const $={};8192&n[0]|512&n[1]&&($.$$scope={dirty:n,ctx:t}),e.$set($)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){v(e.$$.fragment,t),n=!1},d(t){x(e,t)}}}function ot(t){let e,n,k,w,y,b,T,j,E,I,D,G,F,C,N,S,A,B,H,L;function q(e){t[20](e)}let K={modalHeading:"Delete item",primaryButtonText:"Delete",secondaryButtonText:"Cancel",$$slots:{default:[R]},$$scope:{ctx:t}};function M(e){t[22](e)}void 0!==t[13]&&(K.open=t[13]),e=new $({props:K}),s.push((()=>a(e,"open",q))),e.$on("click:button--secondary",t[21]),e.$on("submit",t[15]);let O={};function J(e){t[24](e)}void 0!==t[7]&&(O.image=t[7]),y=new z({props:O}),s.push((()=>a(y,"image",M))),j=new r({props:{noGutter:!0,$$slots:{default:[V]},$$scope:{ctx:t}}});let Q={};return void 0!==t[10]&&(Q.tags=t[10]),I=new P({props:Q}),s.push((()=>a(I,"tags",J))),F=new r({props:{noGutter:!0,$$slots:{default:[X]},$$scope:{ctx:t}}}),N=new r({props:{noGutter:!0,$$slots:{default:[nt]},$$scope:{ctx:t}}}),A=new r({props:{noGutter:!0,$$slots:{default:[rt]},$$scope:{ctx:t}}}),{c(){o(e.$$.fragment),k=i(),w=i(),o(y.$$.fragment),T=i(),o(j.$$.fragment),E=i(),o(I.$$.fragment),G=i(),o(F.$$.fragment),C=i(),o(N.$$.fragment),S=i(),o(A.$$.fragment),this.h()},l(t){c(e.$$.fragment,t),k=f(t);m('[data-svelte="svelte-m9ymwm"]',document.head).forEach(l),w=f(t),c(y.$$.fragment,t),T=f(t),c(j.$$.fragment,t),E=f(t),c(I.$$.fragment,t),G=f(t),c(F.$$.fragment,t),C=f(t),c(N.$$.fragment,t),S=f(t),c(A.$$.fragment,t),this.h()},h(){document.title="Edit Item"},m(n,$){u(e,n,$),p(n,k,$),p(n,w,$),u(y,n,$),p(n,T,$),u(j,n,$),p(n,E,$),u(I,n,$),p(n,G,$),u(F,n,$),p(n,C,$),u(N,n,$),p(n,S,$),u(A,n,$),B=!0,H||(L=d(window,"keydown",t[14]),H=!0)},p(t,$){const s={};512&$[1]&&(s.$$scope={dirty:$,ctx:t}),!n&&8192&$[0]&&(n=!0,s.open=t[13],g((()=>n=!1))),e.$set(s);const a={};!b&&128&$[0]&&(b=!0,a.image=t[7],g((()=>b=!1))),y.$set(a);const r={};16&$[0]|512&$[1]&&(r.$$scope={dirty:$,ctx:t}),j.$set(r);const o={};!D&&1024&$[0]&&(D=!0,o.tags=t[10],g((()=>D=!1))),I.$set(o);const i={};256&$[0]|512&$[1]&&(i.$$scope={dirty:$,ctx:t}),F.$set(i);const c={};6767&$[0]|512&$[1]&&(c.$$scope={dirty:$,ctx:t}),N.$set(c);const f={};8192&$[0]|512&$[1]&&(f.$$scope={dirty:$,ctx:t}),A.$set(f)},i(t){B||(h(e.$$.fragment,t),h(y.$$.fragment,t),h(j.$$.fragment,t),h(I.$$.fragment,t),h(F.$$.fragment,t),h(N.$$.fragment,t),h(A.$$.fragment,t),B=!0)},o(t){v(e.$$.fragment,t),v(y.$$.fragment,t),v(j.$$.fragment,t),v(I.$$.fragment,t),v(F.$$.fragment,t),v(N.$$.fragment,t),v(A.$$.fragment,t),B=!1},d(t){x(e,t),t&&l(k),t&&l(w),x(y,t),t&&l(T),x(j,t),t&&l(E),x(I,t),t&&l(G),x(F,t),t&&l(C),x(N,t),t&&l(S),x(A,t),H=!1,L()}}}async function it({page:t,session:e}){let n=e.token;if(!n)return{status:302,redirect:"/login"};let{id:$}=t.params,s=await H(`items/${$}`),a=await H("user",n);return s.user!==a.username?{status:302,redirect:"/items/{user.id}"}:{props:{token:n,item:s,user:a}}}function ct(t,e,n){let $,s,a,r,{token:o}=e,{item:i}=e,{user:c}=e,f=i.itext,m=i.hidden,l=i.redirect,u=i.price,p=i.link,d=i.itype,g=i.image,h=i.fields||[],v=i.name,x=i.tags,k='Add a url scheme to the link, something like "http://, at the beginning';const w=async()=>{if(l&&!O.test(p))return console.log("invalid"),void n(1,a=!0);let t={itext:f,image:g,link:p,redirect:l,hidden:m,fields:h,price:u,itype:d,name:v,tags:x},e=await q(`items/${i.id}`,t,o).finally((t=>(console.log(t),t)));e.nameError&&(n(2,$=!0),nameError=e.nameError),e.id&&K(`/item/${e.id}`)};return t.$$set=t=>{"token"in t&&n(17,o=t.token),"item"in t&&n(18,i=t.item),"user"in t&&n(19,c=t.user)},t.$$.update=()=>{2&t.$$.dirty[0]&&console.log(a),1&t.$$.dirty[0]&&n(0,d=M(d))},[d,a,$,f,m,l,p,g,h,v,x,s,k,r,t=>{switch(t.keyCode){case 13:t.ctrlKey&&w()}},async()=>{(await L(`items/${i.id}`,o).finally((t=>t))).yes&&K(`/items/${c.id}`)},w,o,i,c,function(t){r=t,n(13,r)},()=>n(13,r=!1),function(t){g=t,n(7,g)},function(t){m=t,n(4,m)},function(t){x=t,n(10,x)},function(t){h=t,n(8,h)},function(t){v=t,n(9,v)},function(t){$=t,n(2,$)},function(t){d=t,n(0,d)},function(t){l=t,n(5,l)},function(t){a=t,n(1,a)},function(t){k=t,n(12,k)},function(t){p=t,n(6,p)},function(t){s=t,n(11,s)},()=>{n(1,a=!1),s.focus()},function(t){f=t,n(3,f)},()=>n(13,r=!0)]}class ft extends t{constructor(t){super(),e(this,t,ct,ot,n,{token:17,item:18,user:19},null,[-1,-1])}}export{ft as default,it as load};
