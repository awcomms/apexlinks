import{S as t,i as e,s as n,ap as $,E as s,F as a,a1 as r,j as o,k as i,m as c,n as f,a5 as m,d as u,o as l,f as p,O as d,G as g,v as h,r as v,w as x,a2 as k,al as w,e as y,t as b,c as T,a as j,g as E,a4 as I,az as D,ak as G,am as B,an as C,l as F,B as N,u as S,aA as A}from"../../chunks/vendor-83a11e53.js";import{a as H}from"../../chunks/api-5c0c9630.js";import{g as L}from"../../chunks/navigation-20968cc5.js";import{i as z}from"../../chunks/initialCaps-68f7c1e1.js";import{T as K}from"../../chunks/Tag-875b6479.js";import{I as M}from"../../chunks/Image-7ac14d1b.js";import{F as O}from"../../chunks/Fields-5e165ace.js";import{I as P}from"../../chunks/Input-a2a62266.js";import{a as q}from"../../chunks/abslink-3768d0d8.js";import"../../chunks/post-5b27026c.js";import"../../chunks/singletons-bb9012b7.js";function J(t){let e,n;return{c(){e=y("p"),n=b("Sure you want to delete this item?")},l(t){e=T(t,"P",{});var $=j(e);n=E($,"Sure you want to delete this item?"),$.forEach(u)},m(t,$){p(t,e,$),I(e,n)},d(t){t&&u(e)}}}function Q(t){let e,n,$;function r(e){t[22](e)}let i={labelText:"Hidden"};return void 0!==t[3]&&(i.checked=t[3]),e=new D({props:i}),s.push((()=>a(e,"checked",r))),{c(){o(e.$$.fragment)},l(t){c(e.$$.fragment,t)},m(t,n){l(e,t,n),$=!0},p(t,$){const s={};!n&&8&$[0]&&(n=!0,s.checked=t[3],g((()=>n=!1))),e.$set(s)},i(t){$||(h(e.$$.fragment,t),$=!0)},o(t){v(e.$$.fragment,t),$=!1},d(t){x(e,t)}}}function R(t){let e,n;return e=new k({props:{$$slots:{default:[Q]},$$scope:{ctx:t}}}),{c(){o(e.$$.fragment)},l(t){c(e.$$.fragment,t)},m(t,$){l(e,t,$),n=!0},p(t,n){const $={};8&n[0]|256&n[1]&&($.$$scope={dirty:n,ctx:t}),e.$set($)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){v(e.$$.fragment,t),n=!1},d(t){x(e,t)}}}function U(t){let e,n,$;function r(e){t[24](e)}let i={pin:!0};return void 0!==t[7]&&(i.fields=t[7]),e=new O({props:i}),s.push((()=>a(e,"fields",r))),{c(){o(e.$$.fragment)},l(t){c(e.$$.fragment,t)},m(t,n){l(e,t,n),$=!0},p(t,$){const s={};!n&&128&$[0]&&(n=!0,s.fields=t[7],g((()=>n=!1))),e.$set(s)},i(t){$||(h(e.$$.fragment,t),$=!0)},o(t){v(e.$$.fragment,t),$=!1},d(t){x(e,t)}}}function V(t){let e,n;return e=new k({props:{$$slots:{default:[U]},$$scope:{ctx:t}}}),{c(){o(e.$$.fragment)},l(t){c(e.$$.fragment,t)},m(t,$){l(e,t,$),n=!0},p(t,n){const $={};128&n[0]|256&n[1]&&($.$$scope={dirty:n,ctx:t}),e.$set($)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){v(e.$$.fragment,t),n=!1},d(t){x(e,t)}}}function W(t){let e,n,$,r;function i(e){t[25](e)}function f(e){t[26](e)}let m={labelText:"Name",invalidText:"Name taken"};return void 0!==t[8]&&(m.value=t[8]),void 0!==t[1]&&(m.invalid=t[1]),e=new P({props:m}),s.push((()=>a(e,"value",i))),s.push((()=>a(e,"invalid",f))),{c(){o(e.$$.fragment)},l(t){c(e.$$.fragment,t)},m(t,n){l(e,t,n),r=!0},p(t,s){const a={};!n&&256&s[0]&&(n=!0,a.value=t[8],g((()=>n=!1))),!$&&2&s[0]&&($=!0,a.invalid=t[1],g((()=>$=!1))),e.$set(a)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){x(e,t)}}}function X(t){let e,n,$;function r(e){t[34](e)}let i={placeholder:"Description(Markdown)"};return void 0!==t[2]&&(i.value=t[2]),e=new A({props:i}),s.push((()=>a(e,"value",r))),{c(){o(e.$$.fragment)},l(t){c(e.$$.fragment,t)},m(t,n){l(e,t,n),$=!0},p(t,$){const s={};!n&&4&$[0]&&(n=!0,s.value=t[2],g((()=>n=!1))),e.$set(s)},i(t){$||(h(e.$$.fragment,t),$=!0)},o(t){v(e.$$.fragment,t),$=!1},d(t){x(e,t)}}}function Y(t){let e,n,$,r,i,f;function m(e){t[29](e)}function u(e){t[30](e)}function p(e){t[31](e)}function d(e){t[32](e)}let k={labelText:"Link"};return void 0!==t[11]&&(k.invalid=t[11]),void 0!==t[12]&&(k.invalidText=t[12]),void 0!==t[5]&&(k.value=t[5]),void 0!==t[10]&&(k.ref=t[10]),e=new P({props:k}),s.push((()=>a(e,"invalid",m))),s.push((()=>a(e,"invalidText",u))),s.push((()=>a(e,"value",p))),s.push((()=>a(e,"ref",d))),e.$on("input",t[33]),{c(){o(e.$$.fragment)},l(t){c(e.$$.fragment,t)},m(t,n){l(e,t,n),f=!0},p(t,s){const a={};!n&&2048&s[0]&&(n=!0,a.invalid=t[11],g((()=>n=!1))),!$&&4096&s[0]&&($=!0,a.invalidText=t[12],g((()=>$=!1))),!r&&32&s[0]&&(r=!0,a.value=t[5],g((()=>r=!1))),!i&&1024&s[0]&&(i=!0,a.ref=t[10],g((()=>i=!1))),e.$set(a)},i(t){f||(h(e.$$.fragment,t),f=!0)},o(t){v(e.$$.fragment,t),f=!1},d(t){x(e,t)}}}function Z(t){let e,n,$,r,m,d,k,w,y,b;function T(e){t[27](e)}let j={labelText:"Item type"};function E(e){t[28](e)}void 0!==t[0]&&(j.value=t[0]),e=new C({props:j}),s.push((()=>a(e,"value",T)));let I={labelText:"Let the item's listing redirect to a link"};void 0!==t[4]&&(I.checked=t[4]),r=new D({props:I}),s.push((()=>a(r,"checked",E)));const G=[Y,X],B=[];function A(t,e){return t[4]?0:1}return k=A(t),w=B[k]=G[k](t),{c(){o(e.$$.fragment),$=i(),o(r.$$.fragment),d=i(),w.c(),y=F()},l(t){c(e.$$.fragment,t),$=f(t),c(r.$$.fragment,t),d=f(t),w.l(t),y=F()},m(t,n){l(e,t,n),p(t,$,n),l(r,t,n),p(t,d,n),B[k].m(t,n),p(t,y,n),b=!0},p(t,$){const s={};!n&&1&$[0]&&(n=!0,s.value=t[0],g((()=>n=!1))),e.$set(s);const a={};!m&&16&$[0]&&(m=!0,a.checked=t[4],g((()=>m=!1))),r.$set(a);let o=k;k=A(t),k===o?B[k].p(t,$):(N(),v(B[o],1,1,(()=>{B[o]=null})),S(),w=B[k],w?w.p(t,$):(w=B[k]=G[k](t),w.c()),h(w,1),w.m(y.parentNode,y))},i(t){b||(h(e.$$.fragment,t),h(r.$$.fragment,t),h(w),b=!0)},o(t){v(e.$$.fragment,t),v(r.$$.fragment,t),v(w),b=!1},d(t){x(e,t),t&&u($),x(r,t),t&&u(d),B[k].d(t),t&&u(y)}}}function _(t){let e,n,$,s;return e=new G({props:{$$slots:{default:[W]},$$scope:{ctx:t}}}),$=new G({props:{$$slots:{default:[Z]},$$scope:{ctx:t}}}),{c(){o(e.$$.fragment),n=i(),o($.$$.fragment)},l(t){c(e.$$.fragment,t),n=f(t),c($.$$.fragment,t)},m(t,a){l(e,t,a),p(t,n,a),l($,t,a),s=!0},p(t,n){const s={};258&n[0]|256&n[1]&&(s.$$scope={dirty:n,ctx:t}),e.$set(s);const a={};7221&n[0]|256&n[1]&&(a.$$scope={dirty:n,ctx:t}),$.$set(a)},i(t){s||(h(e.$$.fragment,t),h($.$$.fragment,t),s=!0)},o(t){v(e.$$.fragment,t),v($.$$.fragment,t),s=!1},d(t){x(e,t),t&&u(n),x($,t)}}}function tt(t){let e,n;return e=new k({props:{$$slots:{default:[_]},$$scope:{ctx:t}}}),{c(){o(e.$$.fragment)},l(t){c(e.$$.fragment,t)},m(t,$){l(e,t,$),n=!0},p(t,n){const $={};7479&n[0]|256&n[1]&&($.$$scope={dirty:n,ctx:t}),e.$set($)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){v(e.$$.fragment,t),n=!1},d(t){x(e,t)}}}function et(t){let e;return{c(){e=b("Delete Item")},l(t){e=E(t,"Delete Item")},m(t,n){p(t,e,n)},d(t){t&&u(e)}}}function nt(t){let e;return{c(){e=b("Edit")},l(t){e=E(t,"Edit")},m(t,n){p(t,e,n)},d(t){t&&u(e)}}}function $t(t){let e,n,$,s;return e=new B({props:{$$slots:{default:[et]},$$scope:{ctx:t}}}),e.$on("click",t[35]),$=new B({props:{$$slots:{default:[nt]},$$scope:{ctx:t}}}),$.$on("click",t[16]),{c(){o(e.$$.fragment),n=i(),o($.$$.fragment)},l(t){c(e.$$.fragment,t),n=f(t),c($.$$.fragment,t)},m(t,a){l(e,t,a),p(t,n,a),l($,t,a),s=!0},p(t,n){const s={};256&n[1]&&(s.$$scope={dirty:n,ctx:t}),e.$set(s);const a={};256&n[1]&&(a.$$scope={dirty:n,ctx:t}),$.$set(a)},i(t){s||(h(e.$$.fragment,t),h($.$$.fragment,t),s=!0)},o(t){v(e.$$.fragment,t),v($.$$.fragment,t),s=!1},d(t){x(e,t),t&&u(n),x($,t)}}}function st(t){let e,n;return e=new w({props:{stacked:!0,$$slots:{default:[$t]},$$scope:{ctx:t}}}),{c(){o(e.$$.fragment)},l(t){c(e.$$.fragment,t)},m(t,$){l(e,t,$),n=!0},p(t,n){const $={};8192&n[0]|256&n[1]&&($.$$scope={dirty:n,ctx:t}),e.$set($)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){v(e.$$.fragment,t),n=!1},d(t){x(e,t)}}}function at(t){let e,n,k,w,y,b,T,j,E,I,D,G,B,C,F,N,S,A,H,L;function z(e){t[19](e)}let O={modalHeading:"Delete item",primaryButtonText:"Delete",secondaryButtonText:"Cancel",$$slots:{default:[J]},$$scope:{ctx:t}};function P(e){t[21](e)}void 0!==t[13]&&(O.open=t[13]),e=new $({props:O}),s.push((()=>a(e,"open",z))),e.$on("click:button--secondary",t[20]),e.$on("submit",t[15]);let q={};function Q(e){t[23](e)}void 0!==t[6]&&(q.image=t[6]),y=new M({props:q}),s.push((()=>a(y,"image",P))),j=new r({props:{noGutter:!0,$$slots:{default:[R]},$$scope:{ctx:t}}});let U={};return void 0!==t[9]&&(U.tags=t[9]),I=new K({props:U}),s.push((()=>a(I,"tags",Q))),B=new r({props:{noGutter:!0,$$slots:{default:[V]},$$scope:{ctx:t}}}),F=new r({props:{noGutter:!0,$$slots:{default:[tt]},$$scope:{ctx:t}}}),S=new r({props:{noGutter:!0,$$slots:{default:[st]},$$scope:{ctx:t}}}),{c(){o(e.$$.fragment),k=i(),w=i(),o(y.$$.fragment),T=i(),o(j.$$.fragment),E=i(),o(I.$$.fragment),G=i(),o(B.$$.fragment),C=i(),o(F.$$.fragment),N=i(),o(S.$$.fragment),this.h()},l(t){c(e.$$.fragment,t),k=f(t);m('[data-svelte="svelte-m9ymwm"]',document.head).forEach(u),w=f(t),c(y.$$.fragment,t),T=f(t),c(j.$$.fragment,t),E=f(t),c(I.$$.fragment,t),G=f(t),c(B.$$.fragment,t),C=f(t),c(F.$$.fragment,t),N=f(t),c(S.$$.fragment,t),this.h()},h(){document.title="Edit Item"},m(n,$){l(e,n,$),p(n,k,$),p(n,w,$),l(y,n,$),p(n,T,$),l(j,n,$),p(n,E,$),l(I,n,$),p(n,G,$),l(B,n,$),p(n,C,$),l(F,n,$),p(n,N,$),l(S,n,$),A=!0,H||(L=d(window,"keydown",t[14]),H=!0)},p(t,$){const s={};256&$[1]&&(s.$$scope={dirty:$,ctx:t}),!n&&8192&$[0]&&(n=!0,s.open=t[13],g((()=>n=!1))),e.$set(s);const a={};!b&&64&$[0]&&(b=!0,a.image=t[6],g((()=>b=!1))),y.$set(a);const r={};8&$[0]|256&$[1]&&(r.$$scope={dirty:$,ctx:t}),j.$set(r);const o={};!D&&512&$[0]&&(D=!0,o.tags=t[9],g((()=>D=!1))),I.$set(o);const i={};128&$[0]|256&$[1]&&(i.$$scope={dirty:$,ctx:t}),B.$set(i);const c={};7479&$[0]|256&$[1]&&(c.$$scope={dirty:$,ctx:t}),F.$set(c);const f={};8192&$[0]|256&$[1]&&(f.$$scope={dirty:$,ctx:t}),S.$set(f)},i(t){A||(h(e.$$.fragment,t),h(y.$$.fragment,t),h(j.$$.fragment,t),h(I.$$.fragment,t),h(B.$$.fragment,t),h(F.$$.fragment,t),h(S.$$.fragment,t),A=!0)},o(t){v(e.$$.fragment,t),v(y.$$.fragment,t),v(j.$$.fragment,t),v(I.$$.fragment,t),v(B.$$.fragment,t),v(F.$$.fragment,t),v(S.$$.fragment,t),A=!1},d(t){x(e,t),t&&u(k),t&&u(w),x(y,t),t&&u(T),x(j,t),t&&u(E),x(I,t),t&&u(G),x(B,t),t&&u(C),x(F,t),t&&u(N),x(S,t),H=!1,L()}}}async function rt({page:t,session:e}){let n=e.user;if(!n)return{status:302,redirect:"/login"};let{id:$}=t.params,s=await H.get(`items/${$}`);return s.user!==n.username?{status:302,redirect:"/items/{user.id}"}:{props:{item:s,user:n}}}function ot(t,e,n){let $,s,a,r,{item:o}=e,{user:i}=e,c=o.itext,f=o.hidden,m=o.redirect,u=o.price,l=o.link,p=o.itype,d=o.image,g=o.fields||[],h=o.name,v=o.tags,x='Add a url scheme to the link, something like "http://, at the beginning';const k=async()=>{if(m&&!q.test(l))return void n(11,a=!0);let t={itext:c,image:d,link:l,redirect:m,hidden:f,fields:g,price:u,itype:p,name:h,tags:v},e=await H.put(`items/${o.id}`,t).finally((t=>t));e.nameError&&(n(1,$=!0),nameError=e.nameError),e.id&&L(`/item/${e.id}`)};return t.$$set=t=>{"item"in t&&n(17,o=t.item),"user"in t&&n(18,i=t.user)},t.$$.update=()=>{1&t.$$.dirty[0]&&n(0,p=z(p))},[p,$,c,f,m,l,d,g,h,v,s,a,x,r,t=>{switch(t.keyCode){case 13:t.ctrlKey&&k()}},async()=>{(await H.del(`items/${o.id}`).finally((t=>t))).yes&&L(`/items/${i.id}`)},k,o,i,function(t){r=t,n(13,r)},()=>n(13,r=!1),function(t){d=t,n(6,d)},function(t){f=t,n(3,f)},function(t){v=t,n(9,v)},function(t){g=t,n(7,g)},function(t){h=t,n(8,h)},function(t){$=t,n(1,$)},function(t){p=t,n(0,p)},function(t){m=t,n(4,m)},function(t){a=t,n(11,a)},function(t){x=t,n(12,x)},function(t){l=t,n(5,l)},function(t){s=t,n(10,s)},()=>{n(11,a=!1),s.focus()},function(t){c=t,n(2,c)},()=>n(13,r=!0)]}export default class extends t{constructor(t){super(),e(this,t,ot,at,n,{item:17,user:18},null,[-1,-1])}}export{rt as load};
