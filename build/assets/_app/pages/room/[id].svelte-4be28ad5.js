import{S as e,i as t,s,a1 as a,j as n,m as r,o,v as c,r as l,w as i,k as $,a5 as f,d as m,n as u,f as p,O as d,u as g,a6 as h,I as v,K as w,aI as y,z as k,Q as x,a2 as b,B as j,e as E,t as P,c as A,a as G,g as B,b as I,ac as T,a4 as H,h as L,P as N,aA as S,E as z,F as C,G as D,a8 as F}from"../../chunks/vendor-83a11e53.js";import{a as K}from"../../chunks/api-5c0c9630.js";import{g as O}from"../../chunks/navigation-20968cc5.js";import{c as Q}from"../../chunks/stores-744e0037.js";import"../../chunks/post-5b27026c.js";import"../../chunks/singletons-bb9012b7.js";const{document:R,window:V}=x;function Y(e,t,s){const a=e.slice();return a[20]=t[s],a}function q(e){let t,s,a,n,r,o,c,l,i,f,g,h,v=e[1].name+"";return{c(){t=E("span"),s=E("p"),a=P(v),n=$(),r=E("p"),o=P("Leave"),c=$(),l=E("br"),i=$(),f=E("div"),this.h()},l(e){t=A(e,"SPAN",{});var $=G(t);s=A($,"P",{class:!0});var p=G(s);a=B(p,v),p.forEach(m),n=u($),r=A($,"P",{class:!0});var d=G(r);o=B(d,"Leave"),d.forEach(m),c=u($),l=A($,"BR",{}),$.forEach(m),i=u(e),f=A(e,"DIV",{class:!0}),G(f).forEach(m),this.h()},h(){I(s,"class","head svelte-18f507d"),T(s,"head-link",e[1].user==e[2].username),I(r,"class","pointer svelte-18f507d"),I(f,"class","head-space svelte-18f507d")},m($,m){p($,t,m),H(t,s),H(s,a),H(t,n),H(t,r),H(r,o),H(t,c),H(t,l),p($,i,m),p($,f,m),g||(h=[d(s,"click",e[7]),d(r,"click",e[6])],g=!0)},p(e,t){2&t&&v!==(v=e[1].name+"")&&L(a,v),6&t&&T(s,"head-link",e[1].user==e[2].username)},d(e){e&&m(t),e&&m(i),e&&m(f),g=!1,N(h)}}}function J(e){let t,s;return t=new b({props:{$$slots:{default:[q]},$$scope:{ctx:e}}}),{c(){n(t.$$.fragment)},l(e){r(t.$$.fragment,e)},m(e,a){o(t,e,a),s=!0},p(e,s){const a={};8388614&s&&(a.$$scope={dirty:s,ctx:e}),t.$set(a)},i(e){s||(c(t.$$.fragment,e),s=!0)},o(e){l(t.$$.fragment,e),s=!1},d(e){i(t,e)}}}function M(e){let t,s,a,n,r,o,c,l=e[20].user+"",i=e[20].value+"";return{c(){t=E("p"),s=P(l),a=$(),n=E("p"),r=P(i),this.h()},l(e){t=A(e,"P",{class:!0});var o=G(t);s=B(o,l),o.forEach(m),a=u(e),n=A(e,"P",{class:!0});var c=G(n);r=B(c,i),c.forEach(m),this.h()},h(){I(t,"class","small pointer svelte-18f507d"),I(n,"class","message svelte-18f507d")},m(l,i){p(l,t,i),H(t,s),p(l,a,i),p(l,n,i),H(n,r),o||(c=d(t,"click",(function(){F(e[8](e[20].user))&&e[8](e[20].user).apply(this,arguments)})),o=!0)},p(t,a){e=t,1&a&&l!==(l=e[20].user+"")&&L(s,l),1&a&&i!==(i=e[20].value+"")&&L(r,i)},d(e){e&&m(t),e&&m(a),e&&m(n),o=!1,c()}}}function U(e){let t,s;return t=new b({props:{$$slots:{default:[M]},$$scope:{ctx:e}}}),{c(){n(t.$$.fragment)},l(e){r(t.$$.fragment,e)},m(e,a){o(t,e,a),s=!0},p(e,s){const a={};8388609&s&&(a.$$scope={dirty:s,ctx:e}),t.$set(a)},i(e){s||(c(t.$$.fragment,e),s=!0)},o(e){l(t.$$.fragment,e),s=!1},d(e){i(t,e)}}}function W(e){let t,s;return t=new a({props:{noGutter:!0,$$slots:{default:[U]},$$scope:{ctx:e}}}),{c(){n(t.$$.fragment)},l(e){r(t.$$.fragment,e)},m(e,a){o(t,e,a),s=!0},p(e,s){const a={};8388609&s&&(a.$$scope={dirty:s,ctx:e}),t.$set(a)},i(e){s||(c(t.$$.fragment,e),s=!0)},o(e){l(t.$$.fragment,e),s=!1},d(e){i(t,e)}}}function X(e){let t,s,a,$;function f(t){e[13](t)}function m(t){e[14](t)}let u={rows:1};return void 0!==e[4]&&(u.ref=e[4]),void 0!==e[3]&&(u.value=e[3]),t=new S({props:u}),z.push((()=>C(t,"ref",f))),z.push((()=>C(t,"value",m))),{c(){n(t.$$.fragment)},l(e){r(t.$$.fragment,e)},m(e,s){o(t,e,s),$=!0},p(e,n){const r={};!s&&16&n&&(s=!0,r.ref=e[4],D((()=>s=!1))),!a&&8&n&&(a=!0,r.value=e[3],D((()=>a=!1))),t.$set(r)},i(e){$||(c(t.$$.fragment,e),$=!0)},o(e){l(t.$$.fragment,e),$=!1},d(e){i(t,e)}}}function Z(e){let t,s;return t=new b({props:{$$slots:{default:[X]},$$scope:{ctx:e}}}),{c(){n(t.$$.fragment)},l(e){r(t.$$.fragment,e)},m(e,a){o(t,e,a),s=!0},p(e,s){const a={};8388632&s&&(a.$$scope={dirty:s,ctx:e}),t.$set(a)},i(e){s||(c(t.$$.fragment,e),s=!0)},o(e){l(t.$$.fragment,e),s=!1},d(e){i(t,e)}}}function _(e){let t,s,v,w,y,k,x,b,E;R.title=t=e[1].name,v=new a({props:{noGutter:!0,$$slots:{default:[J]},$$scope:{ctx:e}}});let P=e[0],A=[];for(let a=0;a<P.length;a+=1)A[a]=W(Y(e,P,a));const G=e=>l(A[e],1,1,(()=>{A[e]=null}));return k=new a({props:{noGutter:!0,$$slots:{default:[Z]},$$scope:{ctx:e}}}),{c(){s=$(),n(v.$$.fragment),w=$();for(let e=0;e<A.length;e+=1)A[e].c();y=$(),n(k.$$.fragment)},l(e){f('[data-svelte="svelte-skv7af"]',R.head).forEach(m),s=u(e),r(v.$$.fragment,e),w=u(e);for(let t=0;t<A.length;t+=1)A[t].l(e);y=u(e),r(k.$$.fragment,e)},m(t,a){p(t,s,a),o(v,t,a),p(t,w,a);for(let e=0;e<A.length;e+=1)A[e].m(t,a);p(t,y,a),o(k,t,a),x=!0,b||(E=d(V,"keydown",e[5]),b=!0)},p(e,[s]){(!x||2&s)&&t!==(t=e[1].name)&&(R.title=t);const a={};if(8388614&s&&(a.$$scope={dirty:s,ctx:e}),v.$set(a),257&s){let t;for(P=e[0],t=0;t<P.length;t+=1){const a=Y(e,P,t);A[t]?(A[t].p(a,s),c(A[t],1)):(A[t]=W(a),A[t].c(),c(A[t],1),A[t].m(y.parentNode,y))}for(j(),t=P.length;t<A.length;t+=1)G(t);g()}const n={};8388632&s&&(n.$$scope={dirty:s,ctx:e}),k.$set(n)},i(e){if(!x){c(v.$$.fragment,e);for(let e=0;e<P.length;e+=1)c(A[e]);c(k.$$.fragment,e),x=!0}},o(e){l(v.$$.fragment,e),A=A.filter(Boolean);for(let t=0;t<A.length;t+=1)l(A[t]);l(k.$$.fragment,e),x=!1},d(e){e&&m(s),i(v,e),e&&m(w),h(A,e),e&&m(y),i(k,e),b=!1,E()}}}async function ee({page:e,session:t}){let s=t.user;const{id:a}=e.params;if(!s)return{status:302,redirect:"login"};const n=await K.get(`rooms/${a}`);let r,o,c=await K.get(`messages?id=${a}`);return r=c.items,e=c.page,o=c.total,Array.isArray(r)||(r=[]),{props:{room:n,items:r,page:e,total:o,user:s,id:a}}}function te(e,t,s){let a;v(e,Q,(e=>s(15,a=e)));let{room:n,items:r,page:o,total:c,user:l,id:i}=t;w(Q,a=n.name,a);const $=y();let f,m,u;k((()=>{window.scrollTo({left:0,top:document.body.scrollHeight}),s(12,f=!0),u.focus()})),$.on("connect",(()=>{$.emit("join",i)})),$.on("msg",(async e=>{await K.put(`seen?id=${i}`,{}),s(0,r=[...r,e]),d()}));const p=async()=>{if(!m)return;s(3,m=m.trim());let e={user:l.username,id:i,value:m};s(0,r=[...r,e]),$.emit("msg",e),await K.post("messages",{id:i,value:m}),d(),s(3,m="")},d=()=>{setTimeout((()=>{window.scrollTo({left:0,top:document.body.scrollHeight})}),0)};return e.$$set=e=>{"room"in e&&s(1,n=e.room),"items"in e&&s(0,r=e.items),"page"in e&&s(10,o=e.page),"total"in e&&s(9,c=e.total),"user"in e&&s(2,l=e.user),"id"in e&&s(11,i=e.id)},e.$$.update=()=>{4608&e.$$.dirty&&f&&c>100&&0==window.scrollY&&(async()=>{res=await K.get(`messages?id=${i}&page=${o+1}`),s(0,r=res.items),s(9,c=res.total),s(10,o++,o)})()},[r,n,l,m,u,e=>{switch(e.keyCode){case 13:p()}},async()=>{$.emit("leave",n.id),await K.put("leave",{id:n.id}),O("/")},()=>{n.user==l.username&&O(`/edit/${n.id}`)},e=>{O(e)},c,o,i,f,function(e){u=e,s(4,u)},function(e){m=e,s(3,m)}]}export default class extends e{constructor(e){super(),t(this,e,te,_,s,{room:1,items:0,page:10,total:9,user:2,id:11})}}export{ee as load};
