import{S as e,i as t,s,a5 as a,j as n,m as o,o as r,x as c,u as l,v as i,k as $,ab as f,d as m,n as u,f as d,O as p,w as g,ac as h,I as v,K as w,aI as k,A as y,Q as x,a6 as j,r as E,e as b,t as P,c as A,a as G,g as I,b as T,aj as B,a8 as F,h as H,P as L,aF as N,E as S,F as C,G as D,ap as K}from"../../chunks/vendor-c7b4d8a9.js";import{g as O,p as Q,a as R}from"../../chunks/api-eadfccdc.js";import{g as V}from"../../chunks/navigation-51f4a605.js";import{c as Y}from"../../chunks/stores-fc5807c6.js";import"../../chunks/singletons-12a22614.js";const{document:q,window:z}=x;function J(e,t,s){const a=e.slice();return a[20]=t[s],a}function M(e){let t,s,a,n,o,r,c,l,i,f,g,h,v=e[1].name+"";return{c(){t=b("span"),s=b("p"),a=P(v),n=$(),o=b("p"),r=P("Leave"),c=$(),l=b("br"),i=$(),f=b("div"),this.h()},l(e){t=A(e,"SPAN",{});var $=G(t);s=A($,"P",{class:!0});var d=G(s);a=I(d,v),d.forEach(m),n=u($),o=A($,"P",{class:!0});var p=G(o);r=I(p,"Leave"),p.forEach(m),c=u($),l=A($,"BR",{}),$.forEach(m),i=u(e),f=A(e,"DIV",{class:!0}),G(f).forEach(m),this.h()},h(){T(s,"class","head svelte-18f507d"),B(s,"head-link",e[1].user==e[2].username),T(o,"class","pointer svelte-18f507d"),T(f,"class","head-space svelte-18f507d")},m($,m){d($,t,m),F(t,s),F(s,a),F(t,n),F(t,o),F(o,r),F(t,c),F(t,l),d($,i,m),d($,f,m),g||(h=[p(s,"click",e[7]),p(o,"click",e[6])],g=!0)},p(e,t){2&t&&v!==(v=e[1].name+"")&&H(a,v),6&t&&B(s,"head-link",e[1].user==e[2].username)},d(e){e&&m(t),e&&m(i),e&&m(f),g=!1,L(h)}}}function U(e){let t,s;return t=new j({props:{$$slots:{default:[M]},$$scope:{ctx:e}}}),{c(){n(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,a){r(t,e,a),s=!0},p(e,s){const a={};8388614&s&&(a.$$scope={dirty:s,ctx:e}),t.$set(a)},i(e){s||(c(t.$$.fragment,e),s=!0)},o(e){l(t.$$.fragment,e),s=!1},d(e){i(t,e)}}}function W(e){let t,s,a,n,o,r,c,l=e[20].user+"",i=e[20].value+"";return{c(){t=b("p"),s=P(l),a=$(),n=b("p"),o=P(i),this.h()},l(e){t=A(e,"P",{class:!0});var r=G(t);s=I(r,l),r.forEach(m),a=u(e),n=A(e,"P",{class:!0});var c=G(n);o=I(c,i),c.forEach(m),this.h()},h(){T(t,"class","small pointer svelte-18f507d"),T(n,"class","message svelte-18f507d")},m(l,i){d(l,t,i),F(t,s),d(l,a,i),d(l,n,i),F(n,o),r||(c=p(t,"click",(function(){K(e[8](e[20].user))&&e[8](e[20].user).apply(this,arguments)})),r=!0)},p(t,a){e=t,1&a&&l!==(l=e[20].user+"")&&H(s,l),1&a&&i!==(i=e[20].value+"")&&H(o,i)},d(e){e&&m(t),e&&m(a),e&&m(n),r=!1,c()}}}function X(e){let t,s;return t=new j({props:{$$slots:{default:[W]},$$scope:{ctx:e}}}),{c(){n(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,a){r(t,e,a),s=!0},p(e,s){const a={};8388609&s&&(a.$$scope={dirty:s,ctx:e}),t.$set(a)},i(e){s||(c(t.$$.fragment,e),s=!0)},o(e){l(t.$$.fragment,e),s=!1},d(e){i(t,e)}}}function Z(e){let t,s;return t=new a({props:{noGutter:!0,$$slots:{default:[X]},$$scope:{ctx:e}}}),{c(){n(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,a){r(t,e,a),s=!0},p(e,s){const a={};8388609&s&&(a.$$scope={dirty:s,ctx:e}),t.$set(a)},i(e){s||(c(t.$$.fragment,e),s=!0)},o(e){l(t.$$.fragment,e),s=!1},d(e){i(t,e)}}}function _(e){let t,s,a,$;function f(t){e[13](t)}function m(t){e[14](t)}let u={rows:1};return void 0!==e[4]&&(u.ref=e[4]),void 0!==e[3]&&(u.value=e[3]),t=new N({props:u}),S.push((()=>C(t,"ref",f))),S.push((()=>C(t,"value",m))),{c(){n(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,s){r(t,e,s),$=!0},p(e,n){const o={};!s&&16&n&&(s=!0,o.ref=e[4],D((()=>s=!1))),!a&&8&n&&(a=!0,o.value=e[3],D((()=>a=!1))),t.$set(o)},i(e){$||(c(t.$$.fragment,e),$=!0)},o(e){l(t.$$.fragment,e),$=!1},d(e){i(t,e)}}}function ee(e){let t,s;return t=new j({props:{$$slots:{default:[_]},$$scope:{ctx:e}}}),{c(){n(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,a){r(t,e,a),s=!0},p(e,s){const a={};8388632&s&&(a.$$scope={dirty:s,ctx:e}),t.$set(a)},i(e){s||(c(t.$$.fragment,e),s=!0)},o(e){l(t.$$.fragment,e),s=!1},d(e){i(t,e)}}}function te(e){let t,s,v,w,k,y,x,j,b;q.title=t=e[1].name,v=new a({props:{noGutter:!0,$$slots:{default:[U]},$$scope:{ctx:e}}});let P=e[0],A=[];for(let a=0;a<P.length;a+=1)A[a]=Z(J(e,P,a));const G=e=>l(A[e],1,1,(()=>{A[e]=null}));return y=new a({props:{noGutter:!0,$$slots:{default:[ee]},$$scope:{ctx:e}}}),{c(){s=$(),n(v.$$.fragment),w=$();for(let e=0;e<A.length;e+=1)A[e].c();k=$(),n(y.$$.fragment)},l(e){f('[data-svelte="svelte-skv7af"]',q.head).forEach(m),s=u(e),o(v.$$.fragment,e),w=u(e);for(let t=0;t<A.length;t+=1)A[t].l(e);k=u(e),o(y.$$.fragment,e)},m(t,a){d(t,s,a),r(v,t,a),d(t,w,a);for(let e=0;e<A.length;e+=1)A[e].m(t,a);d(t,k,a),r(y,t,a),x=!0,j||(b=p(z,"keydown",e[5]),j=!0)},p(e,[s]){(!x||2&s)&&t!==(t=e[1].name)&&(q.title=t);const a={};if(8388614&s&&(a.$$scope={dirty:s,ctx:e}),v.$set(a),257&s){let t;for(P=e[0],t=0;t<P.length;t+=1){const a=J(e,P,t);A[t]?(A[t].p(a,s),c(A[t],1)):(A[t]=Z(a),A[t].c(),c(A[t],1),A[t].m(k.parentNode,k))}for(E(),t=P.length;t<A.length;t+=1)G(t);g()}const n={};8388632&s&&(n.$$scope={dirty:s,ctx:e}),y.$set(n)},i(e){if(!x){c(v.$$.fragment,e);for(let e=0;e<P.length;e+=1)c(A[e]);c(y.$$.fragment,e),x=!0}},o(e){l(v.$$.fragment,e),A=A.filter(Boolean);for(let t=0;t<A.length;t+=1)l(A[t]);l(y.$$.fragment,e),x=!1},d(e){e&&m(s),i(v,e),e&&m(w),h(A,e),e&&m(k),i(y,e),j=!1,b()}}}async function se({page:e,session:t}){let s=t.token;const{id:a}=e.params;if(!s)return{status:302,redirect:"login"};const n=await O(`rooms/${a}`,user.token);let o,r,c=await O(`messages?id=${a}`,user.token);return o=c.items,e=c.page,r=c.total,Array.isArray(o)||(o=[]),{props:{room:n,items:o,page:e,total:r,user:user,id:a}}}function ae(e,t,s){let a;v(e,Y,(e=>s(15,a=e)));let{room:n,items:o,page:r,total:c,user:l,id:i}=t;w(Y,a=n.name,a);const $=k();let f,m,u;y((()=>{window.scrollTo({left:0,top:document.body.scrollHeight}),s(12,f=!0),u.focus()})),$.on("connect",(()=>{$.emit("join",i)})),$.on("msg",(async e=>{await Q(`seen?id=${i}`,{},l.token),s(0,o=[...o,e]),p()}));const d=async()=>{if(!m)return;s(3,m=m.trim());let e={user:l.username,id:i,value:m};s(0,o=[...o,e]),$.emit("msg",e),await R("messages",{id:i,value:m},l.token),p(),s(3,m="")},p=()=>{setTimeout((()=>{window.scrollTo({left:0,top:document.body.scrollHeight})}),0)};return e.$$set=e=>{"room"in e&&s(1,n=e.room),"items"in e&&s(0,o=e.items),"page"in e&&s(10,r=e.page),"total"in e&&s(9,c=e.total),"user"in e&&s(2,l=e.user),"id"in e&&s(11,i=e.id)},e.$$.update=()=>{4608&e.$$.dirty&&f&&c>100&&0==window.scrollY&&(async()=>{res=await O(`messages?id=${i}&page=${r+1}`,l.token),s(0,o=res.items),s(9,c=res.total),s(10,r++,r)})()},[o,n,l,m,u,e=>{switch(e.keyCode){case 13:d()}},async()=>{$.emit("leave",n.id),await Q("leave",{id:n.id},l.token),V("/")},()=>{n.user==l.username&&V(`/edit/${n.id}`)},e=>{V(e)},c,r,i,f,function(e){u=e,s(4,u)},function(e){m=e,s(3,m)}]}class ne extends e{constructor(e){super(),t(this,e,ae,te,s,{room:1,items:0,page:10,total:9,user:2,id:11})}}export{ne as default,se as load};
