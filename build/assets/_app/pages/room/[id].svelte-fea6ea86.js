import{S as e,i as t,s,a3 as a,j as n,m as o,o as r,v as c,r as l,w as i,k as $,a9 as f,d as m,n as u,f as p,O as d,u as g,aa as h,I as v,K as w,aC as k,z as y,Q as x,a4 as b,B as E,e as j,t as P,c as G,a as A,g as B,b as T,ah as z,a6 as C,h as H,P as I,az as L,E as N,F as S,G as D,ad as F}from"../../chunks/vendor-221a53e8.js";import{g as K,p as O,a as Q}from"../../chunks/api-464cac91.js";import{g as R}from"../../chunks/navigation-20968cc5.js";import{c as V}from"../../chunks/stores-132b7e55.js";import"../../chunks/singletons-bb9012b7.js";const{document:Y,window:q}=x;function J(e,t,s){const a=e.slice();return a[20]=t[s],a}function M(e){let t,s,a,n,o,r,c,l,i,f,g,h,v=e[1].name+"";return{c(){t=j("span"),s=j("p"),a=P(v),n=$(),o=j("p"),r=P("Leave"),c=$(),l=j("br"),i=$(),f=j("div"),this.h()},l(e){t=G(e,"SPAN",{});var $=A(t);s=G($,"P",{class:!0});var p=A(s);a=B(p,v),p.forEach(m),n=u($),o=G($,"P",{class:!0});var d=A(o);r=B(d,"Leave"),d.forEach(m),c=u($),l=G($,"BR",{}),$.forEach(m),i=u(e),f=G(e,"DIV",{class:!0}),A(f).forEach(m),this.h()},h(){T(s,"class","head svelte-18f507d"),z(s,"head-link",e[1].user==e[2].username),T(o,"class","pointer svelte-18f507d"),T(f,"class","head-space svelte-18f507d")},m($,m){p($,t,m),C(t,s),C(s,a),C(t,n),C(t,o),C(o,r),C(t,c),C(t,l),p($,i,m),p($,f,m),g||(h=[d(s,"click",e[7]),d(o,"click",e[6])],g=!0)},p(e,t){2&t&&v!==(v=e[1].name+"")&&H(a,v),6&t&&z(s,"head-link",e[1].user==e[2].username)},d(e){e&&m(t),e&&m(i),e&&m(f),g=!1,I(h)}}}function U(e){let t,s;return t=new b({props:{$$slots:{default:[M]},$$scope:{ctx:e}}}),{c(){n(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,a){r(t,e,a),s=!0},p(e,s){const a={};8388614&s&&(a.$$scope={dirty:s,ctx:e}),t.$set(a)},i(e){s||(c(t.$$.fragment,e),s=!0)},o(e){l(t.$$.fragment,e),s=!1},d(e){i(t,e)}}}function W(e){let t,s,a,n,o,r,c,l=e[20].user+"",i=e[20].value+"";return{c(){t=j("p"),s=P(l),a=$(),n=j("p"),o=P(i),this.h()},l(e){t=G(e,"P",{class:!0});var r=A(t);s=B(r,l),r.forEach(m),a=u(e),n=G(e,"P",{class:!0});var c=A(n);o=B(c,i),c.forEach(m),this.h()},h(){T(t,"class","small pointer svelte-18f507d"),T(n,"class","message svelte-18f507d")},m(l,i){p(l,t,i),C(t,s),p(l,a,i),p(l,n,i),C(n,o),r||(c=d(t,"click",(function(){F(e[8](e[20].user))&&e[8](e[20].user).apply(this,arguments)})),r=!0)},p(t,a){e=t,1&a&&l!==(l=e[20].user+"")&&H(s,l),1&a&&i!==(i=e[20].value+"")&&H(o,i)},d(e){e&&m(t),e&&m(a),e&&m(n),r=!1,c()}}}function X(e){let t,s;return t=new b({props:{$$slots:{default:[W]},$$scope:{ctx:e}}}),{c(){n(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,a){r(t,e,a),s=!0},p(e,s){const a={};8388609&s&&(a.$$scope={dirty:s,ctx:e}),t.$set(a)},i(e){s||(c(t.$$.fragment,e),s=!0)},o(e){l(t.$$.fragment,e),s=!1},d(e){i(t,e)}}}function Z(e){let t,s;return t=new a({props:{noGutter:!0,$$slots:{default:[X]},$$scope:{ctx:e}}}),{c(){n(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,a){r(t,e,a),s=!0},p(e,s){const a={};8388609&s&&(a.$$scope={dirty:s,ctx:e}),t.$set(a)},i(e){s||(c(t.$$.fragment,e),s=!0)},o(e){l(t.$$.fragment,e),s=!1},d(e){i(t,e)}}}function _(e){let t,s,a,$;function f(t){e[13](t)}function m(t){e[14](t)}let u={rows:1};return void 0!==e[4]&&(u.ref=e[4]),void 0!==e[3]&&(u.value=e[3]),t=new L({props:u}),N.push((()=>S(t,"ref",f))),N.push((()=>S(t,"value",m))),{c(){n(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,s){r(t,e,s),$=!0},p(e,n){const o={};!s&&16&n&&(s=!0,o.ref=e[4],D((()=>s=!1))),!a&&8&n&&(a=!0,o.value=e[3],D((()=>a=!1))),t.$set(o)},i(e){$||(c(t.$$.fragment,e),$=!0)},o(e){l(t.$$.fragment,e),$=!1},d(e){i(t,e)}}}function ee(e){let t,s;return t=new b({props:{$$slots:{default:[_]},$$scope:{ctx:e}}}),{c(){n(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,a){r(t,e,a),s=!0},p(e,s){const a={};8388632&s&&(a.$$scope={dirty:s,ctx:e}),t.$set(a)},i(e){s||(c(t.$$.fragment,e),s=!0)},o(e){l(t.$$.fragment,e),s=!1},d(e){i(t,e)}}}function te(e){let t,s,v,w,k,y,x,b,j;Y.title=t=e[1].name,v=new a({props:{noGutter:!0,$$slots:{default:[U]},$$scope:{ctx:e}}});let P=e[0],G=[];for(let a=0;a<P.length;a+=1)G[a]=Z(J(e,P,a));const A=e=>l(G[e],1,1,(()=>{G[e]=null}));return y=new a({props:{noGutter:!0,$$slots:{default:[ee]},$$scope:{ctx:e}}}),{c(){s=$(),n(v.$$.fragment),w=$();for(let e=0;e<G.length;e+=1)G[e].c();k=$(),n(y.$$.fragment)},l(e){f('[data-svelte="svelte-skv7af"]',Y.head).forEach(m),s=u(e),o(v.$$.fragment,e),w=u(e);for(let t=0;t<G.length;t+=1)G[t].l(e);k=u(e),o(y.$$.fragment,e)},m(t,a){p(t,s,a),r(v,t,a),p(t,w,a);for(let e=0;e<G.length;e+=1)G[e].m(t,a);p(t,k,a),r(y,t,a),x=!0,b||(j=d(q,"keydown",e[5]),b=!0)},p(e,[s]){(!x||2&s)&&t!==(t=e[1].name)&&(Y.title=t);const a={};if(8388614&s&&(a.$$scope={dirty:s,ctx:e}),v.$set(a),257&s){let t;for(P=e[0],t=0;t<P.length;t+=1){const a=J(e,P,t);G[t]?(G[t].p(a,s),c(G[t],1)):(G[t]=Z(a),G[t].c(),c(G[t],1),G[t].m(k.parentNode,k))}for(E(),t=P.length;t<G.length;t+=1)A(t);g()}const n={};8388632&s&&(n.$$scope={dirty:s,ctx:e}),y.$set(n)},i(e){if(!x){c(v.$$.fragment,e);for(let e=0;e<P.length;e+=1)c(G[e]);c(y.$$.fragment,e),x=!0}},o(e){l(v.$$.fragment,e),G=G.filter(Boolean);for(let t=0;t<G.length;t+=1)l(G[t]);l(y.$$.fragment,e),x=!1},d(e){e&&m(s),i(v,e),e&&m(w),h(G,e),e&&m(k),i(y,e),b=!1,j()}}}async function se({page:e,session:t}){let s=t.token;const{id:a}=e.params;if(!s)return{status:302,redirect:"login"};const n=await K(`rooms/${a}`,user.token);let o,r,c=await K(`messages?id=${a}`,user.token);return o=c.items,e=c.page,r=c.total,Array.isArray(o)||(o=[]),{props:{room:n,items:o,page:e,total:r,user:user,id:a}}}function ae(e,t,s){let a;v(e,V,(e=>s(15,a=e)));let{room:n}=t,{items:o}=t,{page:r}=t,{total:c}=t,{user:l}=t,{id:i}=t;w(V,a=n.name,a);const $=k();let f,m,u;y((()=>{window.scrollTo({left:0,top:document.body.scrollHeight}),s(12,f=!0),u.focus()})),$.on("connect",(()=>{$.emit("join",i)})),$.on("msg",(async e=>{await O(`seen?id=${i}`,{},l.token),s(0,o=[...o,e]),d()}));const p=async()=>{if(!m)return;s(3,m=m.trim());let e={user:l.username,id:i,value:m};s(0,o=[...o,e]),$.emit("msg",e),await Q("messages",{id:i,value:m},l.token),d(),s(3,m="")},d=()=>{setTimeout((()=>{window.scrollTo({left:0,top:document.body.scrollHeight})}),0)};return e.$$set=e=>{"room"in e&&s(1,n=e.room),"items"in e&&s(0,o=e.items),"page"in e&&s(10,r=e.page),"total"in e&&s(9,c=e.total),"user"in e&&s(2,l=e.user),"id"in e&&s(11,i=e.id)},e.$$.update=()=>{4608&e.$$.dirty&&f&&c>100&&0==window.scrollY&&(async()=>{res=await K(`messages?id=${i}&page=${r+1}`,l.token),s(0,o=res.items),s(9,c=res.total),s(10,r++,r)})()},[o,n,l,m,u,e=>{switch(e.keyCode){case 13:p()}},async()=>{$.emit("leave",n.id),await O("leave",{id:n.id},l.token),R("/")},()=>{n.user==l.username&&R(`/edit/${n.id}`)},e=>{R(e)},c,r,i,f,function(e){u=e,s(4,u)},function(e){m=e,s(3,m)}]}export default class extends e{constructor(e){super(),t(this,e,ae,te,s,{room:1,items:0,page:10,total:9,user:2,id:11})}}export{se as load};
