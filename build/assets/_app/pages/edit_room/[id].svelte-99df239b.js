import{S as t,i as e,s as n,a7 as s,E as o,F as a,j as r,m as $,o as c,G as i,v as m,r as u,w as f,a3 as l,k as p,n as d,a9 as g,d as x,f as h,u as w,I as v,a4 as y,ax as k,B as j,K as b,e as E,t as T,c as D,a as B,g as G,a6 as I,aw as N,an as S}from"../../chunks/vendor-221a53e8.js";import{g as z,d as C,p as F}from"../../chunks/api-464cac91.js";import{c as H}from"../../chunks/stores-132b7e55.js";import{g as K}from"../../chunks/navigation-20968cc5.js";import{T as P}from"../../chunks/Tag-9a4ea10c.js";import{I as R}from"../../chunks/Input-cd25684c.js";import"../../chunks/singletons-bb9012b7.js";function Y(t){let e,n;return{c(){e=E("p"),n=T("Sure you want to delete this room?")},l(t){e=D(t,"P",{});var s=B(e);n=G(s,"Sure you want to delete this room?"),s.forEach(x)},m(t,s){h(t,e,s),I(e,n)},d(t){t&&x(e)}}}function q(t){let e,n,s;function l(e){t[10](e)}let p={};return void 0!==t[3]&&(p.tags=t[3]),e=new P({props:p}),o.push((()=>a(e,"tags",l))),{c(){r(e.$$.fragment)},l(t){$(e.$$.fragment,t)},m(t,n){c(e,t,n),s=!0},p(t,s){const o={};!n&&8&s&&(n=!0,o.tags=t[3],i((()=>n=!1))),e.$set(o)},i(t){s||(m(e.$$.fragment,t),s=!0)},o(t){u(e.$$.fragment,t),s=!1},d(t){f(e,t)}}}function A(t){let e,n,s,l;function p(e){t[11](e)}function d(e){t[12](e)}let g={labelText:"Name",invalidText:"Name taken"};return void 0!==t[2]&&(g.value=t[2]),void 0!==t[1]&&(g.invalid=t[1]),e=new R({props:g}),o.push((()=>a(e,"value",p))),o.push((()=>a(e,"invalid",d))),{c(){r(e.$$.fragment)},l(t){$(e.$$.fragment,t)},m(t,n){c(e,t,n),l=!0},p(t,o){const a={};!n&&4&o&&(n=!0,a.value=t[2],i((()=>n=!1))),!s&&2&o&&(s=!0,a.invalid=t[1],i((()=>s=!1))),e.$set(a)},i(t){l||(m(e.$$.fragment,t),l=!0)},o(t){u(e.$$.fragment,t),l=!1},d(t){f(e,t)}}}function J(t){let e,n;return e=new N({props:{$$slots:{default:[A]},$$scope:{ctx:t}}}),{c(){r(e.$$.fragment)},l(t){$(e.$$.fragment,t)},m(t,s){c(e,t,s),n=!0},p(t,n){const s={};32774&n&&(s.$$scope={dirty:n,ctx:t}),e.$set(s)},i(t){n||(m(e.$$.fragment,t),n=!0)},o(t){u(e.$$.fragment,t),n=!1},d(t){f(e,t)}}}function L(t){let e,n;return e=new y({props:{$$slots:{default:[J]},$$scope:{ctx:t}}}),{c(){r(e.$$.fragment)},l(t){$(e.$$.fragment,t)},m(t,s){c(e,t,s),n=!0},p(t,n){const s={};32774&n&&(s.$$scope={dirty:n,ctx:t}),e.$set(s)},i(t){n||(m(e.$$.fragment,t),n=!0)},o(t){u(e.$$.fragment,t),n=!1},d(t){f(e,t)}}}function M(t){let e;return{c(){e=T("Delete")},l(t){e=G(t,"Delete")},m(t,n){h(t,e,n)},d(t){t&&x(e)}}}function O(t){let e;return{c(){e=T("Edit")},l(t){e=G(t,"Edit")},m(t,n){h(t,e,n)},d(t){t&&x(e)}}}function Q(t){let e,n,s,o;return e=new S({props:{$$slots:{default:[M]},$$scope:{ctx:t}}}),e.$on("click",t[13]),s=new S({props:{$$slots:{default:[O]},$$scope:{ctx:t}}}),s.$on("click",t[6]),{c(){r(e.$$.fragment),n=p(),r(s.$$.fragment)},l(t){$(e.$$.fragment,t),n=d(t),$(s.$$.fragment,t)},m(t,a){c(e,t,a),h(t,n,a),c(s,t,a),o=!0},p(t,n){const o={};32768&n&&(o.$$scope={dirty:n,ctx:t}),e.$set(o);const a={};32768&n&&(a.$$scope={dirty:n,ctx:t}),s.$set(a)},i(t){o||(m(e.$$.fragment,t),m(s.$$.fragment,t),o=!0)},o(t){u(e.$$.fragment,t),u(s.$$.fragment,t),o=!1},d(t){f(e,t),t&&x(n),f(s,t)}}}function U(t){let e,n;return e=new k({props:{stacked:!0,$$slots:{default:[Q]},$$scope:{ctx:t}}}),{c(){r(e.$$.fragment)},l(t){$(e.$$.fragment,t)},m(t,s){c(e,t,s),n=!0},p(t,n){const s={};32784&n&&(s.$$scope={dirty:n,ctx:t}),e.$set(s)},i(t){n||(m(e.$$.fragment,t),n=!0)},o(t){u(e.$$.fragment,t),n=!1},d(t){f(e,t)}}}function V(t){let e,n,v,y,k,b,E,T,D;function B(e){t[8](e)}let G={modalHeading:"Delete room",primaryButtonText:"Delete",secondaryButtonText:"Cancel",$$slots:{default:[Y]},$$scope:{ctx:t}};void 0!==t[4]&&(G.open=t[4]),e=new s({props:G}),o.push((()=>a(e,"open",B))),e.$on("click:button--secondary",t[9]),e.$on("submit",t[5]);let I=t[0].open&&q(t);return b=new l({props:{noGutter:!0,$$slots:{default:[L]},$$scope:{ctx:t}}}),T=new l({props:{noGutter:!0,$$slots:{default:[U]},$$scope:{ctx:t}}}),{c(){r(e.$$.fragment),v=p(),y=p(),I&&I.c(),k=p(),r(b.$$.fragment),E=p(),r(T.$$.fragment),this.h()},l(t){$(e.$$.fragment,t),v=d(t);g('[data-svelte="svelte-xpmx5e"]',document.head).forEach(x),y=d(t),I&&I.l(t),k=d(t),$(b.$$.fragment,t),E=d(t),$(T.$$.fragment,t),this.h()},h(){document.title="Edit Room"},m(t,n){c(e,t,n),h(t,v,n),h(t,y,n),I&&I.m(t,n),h(t,k,n),c(b,t,n),h(t,E,n),c(T,t,n),D=!0},p(t,[s]){const o={};32768&s&&(o.$$scope={dirty:s,ctx:t}),!n&&16&s&&(n=!0,o.open=t[4],i((()=>n=!1))),e.$set(o),t[0].open?I?(I.p(t,s),1&s&&m(I,1)):(I=q(t),I.c(),m(I,1),I.m(k.parentNode,k)):I&&(j(),u(I,1,1,(()=>{I=null})),w());const a={};32774&s&&(a.$$scope={dirty:s,ctx:t}),b.$set(a);const r={};32784&s&&(r.$$scope={dirty:s,ctx:t}),T.$set(r)},i(t){D||(m(e.$$.fragment,t),m(I),m(b.$$.fragment,t),m(T.$$.fragment,t),D=!0)},o(t){u(e.$$.fragment,t),u(I),u(b.$$.fragment,t),u(T.$$.fragment,t),D=!1},d(t){f(e,t),t&&x(v),t&&x(y),I&&I.d(t),t&&x(k),f(b,t),t&&x(E),f(T,t)}}}async function W({page:t,session:e}){let n=e.token,{id:s}=t.params,o=await z(`rooms/${s}`);if(!n)return{status:302,redirect:"/login"};let a=await z("user",n);return o.user!=a.username?{error:"You're not authorized to edit this room",status:"401"}:{props:{room:o,user:a}}}function X(t,e,n){let s;v(t,H,(t=>n(14,s=t)));let o,a,{room:r}=e,{user:$}=e,c=r.name,i=r.tags;return t.$$set=t=>{"room"in t&&n(0,r=t.room),"user"in t&&n(7,$=t.user)},[r,o,c,i,a,async function(){(await C(`rooms/${r.id}`,$.token)).yes&&K(`/rooms/${$.id}`)},async function(){let t={id:r.id,name:c,tags:i},e=await F("rooms",t,$.token);e.nameError&&n(1,o=!0),e.id&&(b(H,s=c,s),K(`/room/${r.id}`))},$,function(t){a=t,n(4,a)},()=>n(4,a=!1),function(t){i=t,n(3,i)},function(t){c=t,n(2,c)},function(t){o=t,n(1,o)},()=>n(4,a=!0)]}export default class extends t{constructor(t){super(),e(this,t,X,V,n,{room:0,user:7})}}export{W as load};
