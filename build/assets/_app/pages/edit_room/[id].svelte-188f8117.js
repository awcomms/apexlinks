import{S as t,i as e,s as n,ap as s,E as o,F as a,j as r,m as $,o as c,G as m,v as i,r as u,w as f,a1 as p,k as l,n as d,a5 as g,d as h,f as x,u as v,I as y,a2 as w,al as k,B as j,K as b,e as E,t as T,c as D,a as B,g as G,a4 as I,ak as N,am as S}from"../../chunks/vendor-83a11e53.js";import{a as z}from"../../chunks/api-5c0c9630.js";import{c as C}from"../../chunks/stores-744e0037.js";import{g as F}from"../../chunks/navigation-20968cc5.js";import{T as H}from"../../chunks/Tag-875b6479.js";import{I as K}from"../../chunks/Input-a2a62266.js";import"../../chunks/post-5b27026c.js";import"../../chunks/singletons-bb9012b7.js";function P(t){let e,n;return{c(){e=E("p"),n=T("Sure you want to delete this room?")},l(t){e=D(t,"P",{});var s=B(e);n=G(s,"Sure you want to delete this room?"),s.forEach(h)},m(t,s){x(t,e,s),I(e,n)},d(t){t&&h(e)}}}function R(t){let e,n,s;function p(e){t[10](e)}let l={};return void 0!==t[3]&&(l.tags=t[3]),e=new H({props:l}),o.push((()=>a(e,"tags",p))),{c(){r(e.$$.fragment)},l(t){$(e.$$.fragment,t)},m(t,n){c(e,t,n),s=!0},p(t,s){const o={};!n&&8&s&&(n=!0,o.tags=t[3],m((()=>n=!1))),e.$set(o)},i(t){s||(i(e.$$.fragment,t),s=!0)},o(t){u(e.$$.fragment,t),s=!1},d(t){f(e,t)}}}function Y(t){let e,n,s,p;function l(e){t[11](e)}function d(e){t[12](e)}let g={labelText:"Name",invalidText:"Name taken"};return void 0!==t[2]&&(g.value=t[2]),void 0!==t[1]&&(g.invalid=t[1]),e=new K({props:g}),o.push((()=>a(e,"value",l))),o.push((()=>a(e,"invalid",d))),{c(){r(e.$$.fragment)},l(t){$(e.$$.fragment,t)},m(t,n){c(e,t,n),p=!0},p(t,o){const a={};!n&&4&o&&(n=!0,a.value=t[2],m((()=>n=!1))),!s&&2&o&&(s=!0,a.invalid=t[1],m((()=>s=!1))),e.$set(a)},i(t){p||(i(e.$$.fragment,t),p=!0)},o(t){u(e.$$.fragment,t),p=!1},d(t){f(e,t)}}}function q(t){let e,n;return e=new N({props:{$$slots:{default:[Y]},$$scope:{ctx:t}}}),{c(){r(e.$$.fragment)},l(t){$(e.$$.fragment,t)},m(t,s){c(e,t,s),n=!0},p(t,n){const s={};32774&n&&(s.$$scope={dirty:n,ctx:t}),e.$set(s)},i(t){n||(i(e.$$.fragment,t),n=!0)},o(t){u(e.$$.fragment,t),n=!1},d(t){f(e,t)}}}function A(t){let e,n;return e=new w({props:{$$slots:{default:[q]},$$scope:{ctx:t}}}),{c(){r(e.$$.fragment)},l(t){$(e.$$.fragment,t)},m(t,s){c(e,t,s),n=!0},p(t,n){const s={};32774&n&&(s.$$scope={dirty:n,ctx:t}),e.$set(s)},i(t){n||(i(e.$$.fragment,t),n=!0)},o(t){u(e.$$.fragment,t),n=!1},d(t){f(e,t)}}}function J(t){let e;return{c(){e=T("Delete")},l(t){e=G(t,"Delete")},m(t,n){x(t,e,n)},d(t){t&&h(e)}}}function L(t){let e;return{c(){e=T("Edit")},l(t){e=G(t,"Edit")},m(t,n){x(t,e,n)},d(t){t&&h(e)}}}function M(t){let e,n,s,o;return e=new S({props:{$$slots:{default:[J]},$$scope:{ctx:t}}}),e.$on("click",t[13]),s=new S({props:{$$slots:{default:[L]},$$scope:{ctx:t}}}),s.$on("click",t[6]),{c(){r(e.$$.fragment),n=l(),r(s.$$.fragment)},l(t){$(e.$$.fragment,t),n=d(t),$(s.$$.fragment,t)},m(t,a){c(e,t,a),x(t,n,a),c(s,t,a),o=!0},p(t,n){const o={};32768&n&&(o.$$scope={dirty:n,ctx:t}),e.$set(o);const a={};32768&n&&(a.$$scope={dirty:n,ctx:t}),s.$set(a)},i(t){o||(i(e.$$.fragment,t),i(s.$$.fragment,t),o=!0)},o(t){u(e.$$.fragment,t),u(s.$$.fragment,t),o=!1},d(t){f(e,t),t&&h(n),f(s,t)}}}function O(t){let e,n;return e=new k({props:{stacked:!0,$$slots:{default:[M]},$$scope:{ctx:t}}}),{c(){r(e.$$.fragment)},l(t){$(e.$$.fragment,t)},m(t,s){c(e,t,s),n=!0},p(t,n){const s={};32784&n&&(s.$$scope={dirty:n,ctx:t}),e.$set(s)},i(t){n||(i(e.$$.fragment,t),n=!0)},o(t){u(e.$$.fragment,t),n=!1},d(t){f(e,t)}}}function Q(t){let e,n,y,w,k,b,E,T,D;function B(e){t[8](e)}let G={modalHeading:"Delete room",primaryButtonText:"Delete",secondaryButtonText:"Cancel",$$slots:{default:[P]},$$scope:{ctx:t}};void 0!==t[4]&&(G.open=t[4]),e=new s({props:G}),o.push((()=>a(e,"open",B))),e.$on("click:button--secondary",t[9]),e.$on("submit",t[5]);let I=t[0].open&&R(t);return b=new p({props:{noGutter:!0,$$slots:{default:[A]},$$scope:{ctx:t}}}),T=new p({props:{noGutter:!0,$$slots:{default:[O]},$$scope:{ctx:t}}}),{c(){r(e.$$.fragment),y=l(),w=l(),I&&I.c(),k=l(),r(b.$$.fragment),E=l(),r(T.$$.fragment),this.h()},l(t){$(e.$$.fragment,t),y=d(t);g('[data-svelte="svelte-xpmx5e"]',document.head).forEach(h),w=d(t),I&&I.l(t),k=d(t),$(b.$$.fragment,t),E=d(t),$(T.$$.fragment,t),this.h()},h(){document.title="Edit Room"},m(t,n){c(e,t,n),x(t,y,n),x(t,w,n),I&&I.m(t,n),x(t,k,n),c(b,t,n),x(t,E,n),c(T,t,n),D=!0},p(t,[s]){const o={};32768&s&&(o.$$scope={dirty:s,ctx:t}),!n&&16&s&&(n=!0,o.open=t[4],m((()=>n=!1))),e.$set(o),t[0].open?I?(I.p(t,s),1&s&&i(I,1)):(I=R(t),I.c(),i(I,1),I.m(k.parentNode,k)):I&&(j(),u(I,1,1,(()=>{I=null})),v());const a={};32774&s&&(a.$$scope={dirty:s,ctx:t}),b.$set(a);const r={};32784&s&&(r.$$scope={dirty:s,ctx:t}),T.$set(r)},i(t){D||(i(e.$$.fragment,t),i(I),i(b.$$.fragment,t),i(T.$$.fragment,t),D=!0)},o(t){u(e.$$.fragment,t),u(I),u(b.$$.fragment,t),u(T.$$.fragment,t),D=!1},d(t){f(e,t),t&&h(y),t&&h(w),I&&I.d(t),t&&h(k),f(b,t),t&&h(E),f(T,t)}}}async function U({page:t,session:e}){let n=e.user,{id:s}=t.params,o=await z.get(`rooms/${s}`);return n?o.user!=n.username?{error:"You're not authorized to edit this room",status:"401"}:{props:{room:o,user:n}}:{status:302,redirect:"/login"}}function V(t,e,n){let s;y(t,C,(t=>n(14,s=t)));let o,a,{room:r,user:$}=e,c=r.name,m=r.tags;return t.$$set=t=>{"room"in t&&n(0,r=t.room),"user"in t&&n(7,$=t.user)},[r,o,c,m,a,async function(){(await z.del(`rooms/${r.id}`)).yes&&F(`/rooms/${$.id}`)},async function(){let t={id:r.id,name:c,tags:m},e=await z.put("rooms",t);e.nameError&&n(1,o=!0),e.id&&(b(C,s=c,s),F(`/room/${r.id}`))},$,function(t){a=t,n(4,a)},()=>n(4,a=!1),function(t){m=t,n(3,m)},function(t){c=t,n(2,c)},function(t){o=t,n(1,o)},()=>n(4,a=!0)]}export default class extends t{constructor(t){super(),e(this,t,V,Q,n,{room:0,user:7})}}export{U as load};
