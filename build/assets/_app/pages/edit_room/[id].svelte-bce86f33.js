import{S as P,i as U,s as Y,ap as A,E as S,F as C,j as d,m as g,o as b,G as F,x as p,u as _,v as h,a1 as z,k as E,n as T,a5 as J,d as k,f as w,w as L,I as Q,a2 as V,al as W,r as X,K as Z,e as y,t as G,c as x,a as ee,g as N,a4 as te,ak as ne,am as H}from"../../chunks/vendor-cce9f310.js";import{a as q}from"../../chunks/api-5c0c9630.js";import{c as K}from"../../chunks/stores-befe408a.js";import{g as M}from"../../chunks/navigation-51f4a605.js";import{T as se}from"../../chunks/Tag-6147c832.js";import{I as oe}from"../../chunks/Input-93bd4be1.js";import"../../chunks/post-5b27026c.js";import"../../chunks/singletons-12a22614.js";function ae(r){let e,n;return{c(){e=y("p"),n=G("Sure you want to delete this room?")},l(t){e=x(t,"P",{});var s=ee(e);n=N(s,"Sure you want to delete this room?"),s.forEach(k)},m(t,s){w(t,e,s),te(e,n)},d(t){t&&k(e)}}}function O(r){let e,n,t;function s(u){r[10](u)}let a={};return r[3]!==void 0&&(a.tags=r[3]),e=new se({props:a}),S.push(()=>C(e,"tags",s)),{c(){d(e.$$.fragment)},l(u){g(e.$$.fragment,u)},m(u,i){b(e,u,i),t=!0},p(u,i){const l={};!n&&i&8&&(n=!0,l.tags=u[3],F(()=>n=!1)),e.$set(l)},i(u){t||(p(e.$$.fragment,u),t=!0)},o(u){_(e.$$.fragment,u),t=!1},d(u){h(e,u)}}}function re(r){let e,n,t,s;function a(l){r[11](l)}function u(l){r[12](l)}let i={labelText:"Name",invalidText:"Name taken"};return r[2]!==void 0&&(i.value=r[2]),r[1]!==void 0&&(i.invalid=r[1]),e=new oe({props:i}),S.push(()=>C(e,"value",a)),S.push(()=>C(e,"invalid",u)),{c(){d(e.$$.fragment)},l(l){g(e.$$.fragment,l)},m(l,c){b(e,l,c),s=!0},p(l,c){const v={};!n&&c&4&&(n=!0,v.value=l[2],F(()=>n=!1)),!t&&c&2&&(t=!0,v.invalid=l[1],F(()=>t=!1)),e.$set(v)},i(l){s||(p(e.$$.fragment,l),s=!0)},o(l){_(e.$$.fragment,l),s=!1},d(l){h(e,l)}}}function ue(r){let e,n;return e=new ne({props:{$$slots:{default:[re]},$$scope:{ctx:r}}}),{c(){d(e.$$.fragment)},l(t){g(e.$$.fragment,t)},m(t,s){b(e,t,s),n=!0},p(t,s){const a={};s&32774&&(a.$$scope={dirty:s,ctx:t}),e.$set(a)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){_(e.$$.fragment,t),n=!1},d(t){h(e,t)}}}function le(r){let e,n;return e=new V({props:{$$slots:{default:[ue]},$$scope:{ctx:r}}}),{c(){d(e.$$.fragment)},l(t){g(e.$$.fragment,t)},m(t,s){b(e,t,s),n=!0},p(t,s){const a={};s&32774&&(a.$$scope={dirty:s,ctx:t}),e.$set(a)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){_(e.$$.fragment,t),n=!1},d(t){h(e,t)}}}function fe(r){let e;return{c(){e=G("Delete")},l(n){e=N(n,"Delete")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function ie(r){let e;return{c(){e=G("Edit")},l(n){e=N(n,"Edit")},m(n,t){w(n,e,t)},d(n){n&&k(e)}}}function $e(r){let e,n,t,s;return e=new H({props:{$$slots:{default:[fe]},$$scope:{ctx:r}}}),e.$on("click",r[13]),t=new H({props:{$$slots:{default:[ie]},$$scope:{ctx:r}}}),t.$on("click",r[6]),{c(){d(e.$$.fragment),n=E(),d(t.$$.fragment)},l(a){g(e.$$.fragment,a),n=T(a),g(t.$$.fragment,a)},m(a,u){b(e,a,u),w(a,n,u),b(t,a,u),s=!0},p(a,u){const i={};u&32768&&(i.$$scope={dirty:u,ctx:a}),e.$set(i);const l={};u&32768&&(l.$$scope={dirty:u,ctx:a}),t.$set(l)},i(a){s||(p(e.$$.fragment,a),p(t.$$.fragment,a),s=!0)},o(a){_(e.$$.fragment,a),_(t.$$.fragment,a),s=!1},d(a){h(e,a),a&&k(n),h(t,a)}}}function me(r){let e,n;return e=new W({props:{stacked:!0,$$slots:{default:[$e]},$$scope:{ctx:r}}}),{c(){d(e.$$.fragment)},l(t){g(e.$$.fragment,t)},m(t,s){b(e,t,s),n=!0},p(t,s){const a={};s&32784&&(a.$$scope={dirty:s,ctx:t}),e.$set(a)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){_(e.$$.fragment,t),n=!1},d(t){h(e,t)}}}function ce(r){let e,n,t,s,a,u,i,l,c;function v(o){r[8](o)}let B={modalHeading:"Delete room",primaryButtonText:"Delete",secondaryButtonText:"Cancel",$$slots:{default:[ae]},$$scope:{ctx:r}};r[4]!==void 0&&(B.open=r[4]),e=new A({props:B}),S.push(()=>C(e,"open",v)),e.$on("click:button--secondary",r[9]),e.$on("submit",r[5]);let f=r[0].open&&O(r);return u=new z({props:{noGutter:!0,$$slots:{default:[le]},$$scope:{ctx:r}}}),l=new z({props:{noGutter:!0,$$slots:{default:[me]},$$scope:{ctx:r}}}),{c(){d(e.$$.fragment),t=E(),s=E(),f&&f.c(),a=E(),d(u.$$.fragment),i=E(),d(l.$$.fragment),this.h()},l(o){g(e.$$.fragment,o),t=T(o),J('[data-svelte="svelte-xpmx5e"]',document.head).forEach(k),s=T(o),f&&f.l(o),a=T(o),g(u.$$.fragment,o),i=T(o),g(l.$$.fragment,o),this.h()},h(){document.title="Edit Room"},m(o,$){b(e,o,$),w(o,t,$),w(o,s,$),f&&f.m(o,$),w(o,a,$),b(u,o,$),w(o,i,$),b(l,o,$),c=!0},p(o,[$]){const j={};$&32768&&(j.$$scope={dirty:$,ctx:o}),!n&&$&16&&(n=!0,j.open=o[4],F(()=>n=!1)),e.$set(j),o[0].open?f?(f.p(o,$),$&1&&p(f,1)):(f=O(o),f.c(),p(f,1),f.m(a.parentNode,a)):f&&(X(),_(f,1,1,()=>{f=null}),L());const D={};$&32774&&(D.$$scope={dirty:$,ctx:o}),u.$set(D);const I={};$&32784&&(I.$$scope={dirty:$,ctx:o}),l.$set(I)},i(o){c||(p(e.$$.fragment,o),p(f),p(u.$$.fragment,o),p(l.$$.fragment,o),c=!0)},o(o){_(e.$$.fragment,o),_(f),_(u.$$.fragment,o),_(l.$$.fragment,o),c=!1},d(o){h(e,o),o&&k(t),o&&k(s),f&&f.d(o),o&&k(a),h(u,o),o&&k(i),h(l,o)}}}async function je({page:r,session:e}){let n=e.user,{id:t}=r.params,s=await q.get(`rooms/${t}`);return n?s.user!=n.username?{error:"You're not authorized to edit this room",status:"401"}:{props:{room:s,user:n}}:{status:302,redirect:"/login"}}function pe(r,e,n){let t;Q(r,K,m=>n(14,t=m));let{room:s,user:a}=e,u,i=s.name,l=s.tags,c,v=async function(){(await q.del(`rooms/${s.id}`)).yes&&M(`/rooms/${a.id}`)},B=async function(){let m={id:s.id,name:i,tags:l},R=await q.put("rooms",m);R.nameError&&n(1,u=!0),R.id&&(Z(K,t=i,t),M(`/room/${s.id}`))};function f(m){c=m,n(4,c)}const o=()=>n(4,c=!1);function $(m){l=m,n(3,l)}function j(m){i=m,n(2,i)}function D(m){u=m,n(1,u)}const I=()=>n(4,c=!0);return r.$$set=m=>{"room"in m&&n(0,s=m.room),"user"in m&&n(7,a=m.user)},[s,u,i,l,c,v,B,a,f,o,$,j,D,I]}class Ee extends P{constructor(e){super();U(this,e,pe,ce,Y,{room:0,user:7})}}export{Ee as default,je as load};
