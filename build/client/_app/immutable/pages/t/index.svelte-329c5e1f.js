import{S as j,i as N,s as U,w as p,k as q,x as c,m as A,y as _,g as P,q as $,o as d,B as w,d as R,W as B,_ as G,Y as J}from"../../chunks/index-e47b4649.js";import{a as u,l as W}from"../../chunks/socket-359f452a.js";import{r as Y}from"../../chunks/routes-fb6e9fa0.js";import"../../chunks/HeaderSearch.svelte_svelte_type_style_lang-dee62dc9.js";import{R as y}from"../../chunks/Row-c4df0ce6.js";import{C as z}from"../../chunks/Column-5e525297.js";import{T as D}from"../../chunks/Txt-78062f06.js";import{T as E}from"../../chunks/Tags-072a8ed0.js";import{g as F}from"../../chunks/navigation-0e6511d1.js";import"../../chunks/stores-4f4e660a.js";import"../../chunks/Link-3fffe52b.js";import"../../chunks/TextInput-439d1c85.js";/* empty css                                                      */import"../../chunks/index-8107d937.js";import"../../chunks/Tag-473639f3.js";import"../../chunks/Close-b8ee64fe.js";import"../../chunks/Button-bbcf2e94.js";import"../../chunks/singletons-d1fb5791.js";function H(a){let s,o,t;function r(n){a[12](n)}let e={prefix:"search "};return a[6]!==void 0&&(e.tags=a[6]),s=new E({props:e}),B.push(()=>G(s,"tags",r)),s.$on("change",a[10]),{c(){p(s.$$.fragment)},l(n){c(s.$$.fragment,n)},m(n,f){_(s,n,f),t=!0},p(n,f){const m={};!o&&f&64&&(o=!0,m.tags=n[6],J(()=>o=!1)),s.$set(m)},i(n){t||($(s.$$.fragment,n),t=!0)},o(n){d(s.$$.fragment,n),t=!1},d(n){w(s,n)}}}function I(a){let s,o;return s=new z({props:{$$slots:{default:[H]},$$scope:{ctx:a}}}),{c(){p(s.$$.fragment)},l(t){c(s.$$.fragment,t)},m(t,r){_(s,t,r),o=!0},p(t,r){const e={};r&32832&&(e.$$scope={dirty:r,ctx:t}),s.$set(e)},i(t){o||($(s.$$.fragment,t),o=!0)},o(t){d(s.$$.fragment,t),o=!1},d(t){w(s,t)}}}function L(a){let s,o,t,r;return s=new y({props:{noGutter:!0,$$slots:{default:[I]},$$scope:{ctx:a}}}),t=new D({props:{socket:a[7],txt:a[4],items:a[0],total:a[1],add:a[5],pages:a[3],page:a[2]}}),t.$on("send",a[11]),t.$on("connect",a[9]),t.$on("join",a[8]),t.$on("titleClick",a[13]),{c(){p(s.$$.fragment),o=q(),p(t.$$.fragment)},l(e){c(s.$$.fragment,e),o=A(e),c(t.$$.fragment,e)},m(e,n){_(s,e,n),P(e,o,n),_(t,e,n),r=!0},p(e,[n]){const f={};n&32832&&(f.$$scope={dirty:n,ctx:e}),s.$set(f);const m={};n&16&&(m.txt=e[4]),n&1&&(m.items=e[0]),n&2&&(m.total=e[1]),n&32&&(m.add=e[5]),n&8&&(m.pages=e[3]),n&4&&(m.page=e[2]),t.$set(m)},i(e){r||($(s.$$.fragment,e),$(t.$$.fragment,e),r=!0)},o(e){d(s.$$.fragment,e),d(t.$$.fragment,e),r=!1},d(e){w(s,e),e&&R(o),w(t,e)}}}const pt=async({url:a,fetch:s})=>{const o=a.searchParams.get("id");let t;if(o&&(t=await u.get(`txts?id=${o}`,s),!t.OK))return{status:Number(t.STATUS),error:t.error};let r=o?`txts?id=${o}`:"txts",e=await u.get(r,s);if(!e.OK)return{status:Number(e.STATUS),error:e.error};let{items:n,total:f,page:m,pages:g}=e;return{props:{txt:t,items:n,page:m,pages:g,total:f}}};function M(a,s,o){let{txt:t,items:r,total:e,page:n,pages:f}=s,m=!0;const g=W();let l,T=t?String(t.id):"home";g.on("connect",()=>{b()}),g.on("txt",async i=>{t&&await u.put(`seen?id=${t.id}`,{}),o(0,r=[...r,i]),o(5,m=!m)});const k=()=>{},b=()=>{g.emit("join",T)},O=async()=>{const i=await u.get(`txts?tags=${JSON.stringify(l)}&id=${t.id}`);if(!i.OK){console.log("txt fetch response",i);return}o(0,{items:r,total:e,page:n,pages:f}=i,r,o(1,e),o(2,n),o(3,f))},x=async({detail:i})=>{let S={value:i};t&&(S.txt=t.id),await u.post("txts",S).then(h=>{if(!h.OK){console.log("txt POST response: ",h);return}g.emit("txt",{data:h,room:T})})};function C(i){l=i,o(6,l)}const K=()=>{t&&F(`${Y.txts}/${t.id}/about`)};return a.$$set=i=>{"txt"in i&&o(4,t=i.txt),"items"in i&&o(0,r=i.items),"total"in i&&o(1,e=i.total),"page"in i&&o(2,n=i.page),"pages"in i&&o(3,f=i.pages)},[r,e,n,f,t,m,l,g,k,b,O,x,C,K]}class ct extends j{constructor(s){super(),N(this,s,M,L,U,{txt:4,items:0,total:1,page:2,pages:3})}}export{ct as default,pt as load};
