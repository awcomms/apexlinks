import{S as q,i as A,s as B,w as p,k as R,x as c,m as D,y as _,g as G,q as $,o as d,B as w,d as J,X as P,$ as X,Z}from"../../../chunks/index-3c306420.js";import{a as l,l as y}from"../../../chunks/socket-359f452a.js";import{r as T}from"../../../chunks/routes-fb6e9fa0.js";import"../../../chunks/HeaderSearch.svelte_svelte_type_style_lang-47ee749e.js";import{R as z}from"../../../chunks/Row-ee11b4a3.js";import{C as E}from"../../../chunks/Column-0c866349.js";import{T as F}from"../../../chunks/Txt-584d1737.js";import{T as H}from"../../../chunks/Tags-ad6072fd.js";import{g as C}from"../../../chunks/navigation-0e6511d1.js";import"../../../chunks/index-b8508cdc.js";import"../../../chunks/stores-60fbd2b2.js";import"../../../chunks/Link-ebc57634.js";import"../../../chunks/TextInput-78434c7c.js";/* empty css                                                         */import"../../../chunks/index-7392e856.js";import"../../../chunks/Tag-136bef5b.js";import"../../../chunks/Close-7302402c.js";import"../../../chunks/Button-c662ee71.js";import"../../../chunks/singletons-d1fb5791.js";function I(a){let s,o,t;function i(n){a[12](n)}let e={prefix:"search "};return a[6]!==void 0&&(e.tags=a[6]),s=new H({props:e}),P.push(()=>X(s,"tags",i)),s.$on("change",a[10]),{c(){p(s.$$.fragment)},l(n){c(s.$$.fragment,n)},m(n,f){_(s,n,f),t=!0},p(n,f){const m={};!o&&f&64&&(o=!0,m.tags=n[6],Z(()=>o=!1)),s.$set(m)},i(n){t||($(s.$$.fragment,n),t=!0)},o(n){d(s.$$.fragment,n),t=!1},d(n){w(s,n)}}}function L(a){let s,o;return s=new E({props:{$$slots:{default:[I]},$$scope:{ctx:a}}}),{c(){p(s.$$.fragment)},l(t){c(s.$$.fragment,t)},m(t,i){_(s,t,i),o=!0},p(t,i){const e={};i&65600&&(e.$$scope={dirty:i,ctx:t}),s.$set(e)},i(t){o||($(s.$$.fragment,t),o=!0)},o(t){d(s.$$.fragment,t),o=!1},d(t){w(s,t)}}}function M(a){let s,o,t,i;return s=new z({props:{noGutter:!0,$$slots:{default:[L]},$$scope:{ctx:a}}}),t=new F({props:{socket:a[7],txt:a[4],items:a[0],total:a[1],add:a[5],pages:a[3],page:a[2]}}),t.$on("send",a[11]),t.$on("connect",a[9]),t.$on("join",a[8]),t.$on("titleClick",a[13]),t.$on("itemClick",a[14]),{c(){p(s.$$.fragment),o=R(),p(t.$$.fragment)},l(e){c(s.$$.fragment,e),o=D(e),c(t.$$.fragment,e)},m(e,n){_(s,e,n),G(e,o,n),_(t,e,n),i=!0},p(e,[n]){const f={};n&65600&&(f.$$scope={dirty:n,ctx:e}),s.$set(f);const m={};n&16&&(m.txt=e[4]),n&1&&(m.items=e[0]),n&2&&(m.total=e[1]),n&32&&(m.add=e[5]),n&8&&(m.pages=e[3]),n&4&&(m.page=e[2]),t.$set(m)},i(e){i||($(s.$$.fragment,e),$(t.$$.fragment,e),i=!0)},o(e){d(s.$$.fragment,e),d(t.$$.fragment,e),i=!1},d(e){w(s,e),e&&J(o),w(t,e)}}}const _t=async({params:a,fetch:s})=>{const{id:o}=a;let t;if(o&&(t=await l.get(`txts?id=${o}`,s),!t.OK))return{status:Number(t.STATUS),error:t.error};let i=o?`txts?id=${o}&replies`:"txts",e=await l.get(i,s);if(!e.OK)return{status:Number(e.STATUS),error:e.error};let{items:n,total:f,page:m,pages:g}=e;return{props:{txt:t,items:n,page:m,pages:g,total:f}}};function Q(a,s,o){let{txt:t,items:i,total:e,page:n,pages:f}=s,m=!0;const g=y();let u,k=t?String(t.id):"home";g.on("connect",()=>{b()}),g.on("txt",async r=>{t&&await l.put(`seen?id=${t.id}`,{}),o(0,i=[...i,r]),o(5,m=!m)});const O=()=>{},b=()=>{g.emit("join",k)},x=async()=>{const r=await l.get(`txts?tags=${JSON.stringify(u)}&id=${t.id}&replies`);if(!r.OK){console.log("txt fetch response",r);return}o(0,{items:i,total:e,page:n,pages:f}=r,i,o(1,e),o(2,n),o(3,f))},K=async({detail:r})=>{let S={value:r};t&&(S.txt=t.id),await l.post("txts",S).then(h=>{if(!h.OK){console.log("txt POST response: ",h);return}g.emit("txt",{data:h,room:k})})};function U(r){u=r,o(6,u)}const j=()=>{t&&C(`${T.txts}/${t.id}/about`)},N=({detail:r})=>{t&&C(`${T.txts}/${r.id}`)};return a.$$set=r=>{"txt"in r&&o(4,t=r.txt),"items"in r&&o(0,i=r.items),"total"in r&&o(1,e=r.total),"page"in r&&o(2,n=r.page),"pages"in r&&o(3,f=r.pages)},[i,e,n,f,t,m,u,g,O,b,x,K,U,j,N]}class $t extends q{constructor(s){super(),A(this,s,Q,M,B,{txt:4,items:0,total:1,page:2,pages:3})}}export{$t as default,_t as load};
