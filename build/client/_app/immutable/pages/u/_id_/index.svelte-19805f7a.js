import{S as q,i as K,s as A,W as p,_ as d,w as B,x as j,y as C,Y as c,q as D,o as P,B as W}from"../../../chunks/index-e47b4649.js";import{a as w,p as Y,s as k}from"../../../chunks/socket-359f452a.js";import{r as z}from"../../../chunks/routes-fb6e9fa0.js";import{T as E}from"../../../chunks/Txt-78062f06.js";import"../../../chunks/navigation-0e6511d1.js";import"../../../chunks/singletons-d1fb5791.js";import"../../../chunks/stores-4f4e660a.js";import"../../../chunks/Link-3fffe52b.js";import"../../../chunks/HeaderSearch.svelte_svelte_type_style_lang-dee62dc9.js";import"../../../chunks/Row-c4df0ce6.js";import"../../../chunks/Column-5e525297.js";import"../../../chunks/TextInput-439d1c85.js";/* empty css                                                         */function F(n){let i,s,r,a,o,g,u,f;function l(e){n[9](e)}function b(e){n[10](e)}function x(e){n[11](e)}function T(e){n[12](e)}function S(e){n[13](e)}function U(e){n[14](e)}let m={leaveText:n[6].id===n[5].id?"Texts to self":"Stop receiving txts from this user"};return n[5].username!==void 0&&(m.title=n[5].username),n[4]!==void 0&&(m.txt=n[4]),n[0]!==void 0&&(m.items=n[0]),n[1]!==void 0&&(m.total=n[1]),n[2]!==void 0&&(m.page=n[2]),n[3]!==void 0&&(m.pages=n[3]),i=new E({props:m}),p.push(()=>d(i,"title",l)),p.push(()=>d(i,"txt",b)),p.push(()=>d(i,"items",x)),p.push(()=>d(i,"total",T)),p.push(()=>d(i,"page",S)),p.push(()=>d(i,"pages",U)),i.$on("connect",n[7]),i.$on("send",n[8]),{c(){B(i.$$.fragment)},l(e){j(i.$$.fragment,e)},m(e,_){C(i,e,_),f=!0},p(e,[_]){const t={};_&96&&(t.leaveText=e[6].id===e[5].id?"Texts to self":"Stop receiving txts from this user"),!s&&_&32&&(s=!0,t.title=e[5].username,c(()=>s=!1)),!r&&_&16&&(r=!0,t.txt=e[4],c(()=>r=!1)),!a&&_&1&&(a=!0,t.items=e[0],c(()=>a=!1)),!o&&_&2&&(o=!0,t.total=e[1],c(()=>o=!1)),!g&&_&4&&(g=!0,t.page=e[2],c(()=>g=!1)),!u&&_&8&&(u=!0,t.pages=e[3],c(()=>u=!1)),i.$set(t)},i(e){f||(D(i.$$.fragment,e),f=!0)},o(e){P(i.$$.fragment,e),f=!1},d(e){W(i,e)}}}const $=async({params:n,session:i,fetch:s})=>{const{id:r}=n,a=await w.get(`users/${r}`,s);if(!a.OK)return{status:a.STATUS,error:a.error};if(!i.user)return{status:302,redirect:`${z.users}/${r}/about`};const o=await Y("/send",{path:"txts/users",method:"POST",data:{user:r}},s);if(!o.OK)return{status:o.STATUS,error:o.error};let{items:g,total:u,page:f,pages:l}=await w.get(`txts?id=${o.id}`);return{props:{txt:o,items:g,total:u,page:f,pages:l,user:a,authUser:i.user}}};function G(n,i,s){let{items:r=[],total:a,page:o,pages:g,txt:u,user:f,authUser:l}=i;const b=()=>{k.emit("join",u.id)},x=async({detail:t})=>{const O={txt:u.id,value:t};await w.post("txts",O).then(h=>{if(console.log(h),!h.OK){console.log("not ok - ",h);return}k.emit("txt",h)})};function T(t){n.$$.not_equal(f.username,t)&&(f.username=t,s(5,f))}function S(t){u=t,s(4,u)}function U(t){r=t,s(0,r)}function m(t){a=t,s(1,a)}function e(t){o=t,s(2,o)}function _(t){g=t,s(3,g)}return n.$$set=t=>{"items"in t&&s(0,r=t.items),"total"in t&&s(1,a=t.total),"page"in t&&s(2,o=t.page),"pages"in t&&s(3,g=t.pages),"txt"in t&&s(4,u=t.txt),"user"in t&&s(5,f=t.user),"authUser"in t&&s(6,l=t.authUser)},[r,a,o,g,u,f,l,b,x,T,S,U,m,e,_]}class tt extends q{constructor(i){super(),K(this,i,G,F,A,{items:0,total:1,page:2,pages:3,txt:4,user:5,authUser:6})}}export{tt as default,$ as load};
