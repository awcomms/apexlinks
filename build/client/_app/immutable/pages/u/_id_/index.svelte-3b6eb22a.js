import{S as B,i as j,s as D,X as d,$ as c,w as P,x as X,y as Z,Z as h,q as z,o as E,B as F}from"../../../chunks/index-3c306420.js";import{a as w,p as G,s as O}from"../../../chunks/socket-359f452a.js";import{r as C}from"../../../chunks/routes-fb6e9fa0.js";import{T as H}from"../../../chunks/Txt-584d1737.js";import{g as q}from"../../../chunks/navigation-0e6511d1.js";import"../../../chunks/stores-60fbd2b2.js";import"../../../chunks/Link-ebc57634.js";import"../../../chunks/HeaderSearch.svelte_svelte_type_style_lang-47ee749e.js";import"../../../chunks/index-b8508cdc.js";import"../../../chunks/Row-ee11b4a3.js";import"../../../chunks/Column-0c866349.js";import"../../../chunks/TextInput-78434c7c.js";/* empty css                                                         */import"../../../chunks/singletons-d1fb5791.js";function I(i){let n,s,u,a,o,g,f,r;function p(t){i[9](t)}function x(t){i[10](t)}function T(t){i[11](t)}function S(t){i[12](t)}function k(t){i[13](t)}function U(t){i[14](t)}let l={leaveText:i[6].id===i[5].id?"Texts to self":"Stop receiving txts from this user"};return i[5].username!==void 0&&(l.title=i[5].username),i[4]!==void 0&&(l.txt=i[4]),i[0]!==void 0&&(l.items=i[0]),i[1]!==void 0&&(l.total=i[1]),i[2]!==void 0&&(l.page=i[2]),i[3]!==void 0&&(l.pages=i[3]),n=new H({props:l}),d.push(()=>c(n,"title",p)),d.push(()=>c(n,"txt",x)),d.push(()=>c(n,"items",T)),d.push(()=>c(n,"total",S)),d.push(()=>c(n,"page",k)),d.push(()=>c(n,"pages",U)),n.$on("itemClick",i[15]),n.$on("titleClick",i[16]),n.$on("connect",i[7]),n.$on("send",i[8]),{c(){P(n.$$.fragment)},l(t){X(n.$$.fragment,t)},m(t,_){Z(n,t,_),r=!0},p(t,[_]){const m={};_&96&&(m.leaveText=t[6].id===t[5].id?"Texts to self":"Stop receiving txts from this user"),!s&&_&32&&(s=!0,m.title=t[5].username,h(()=>s=!1)),!u&&_&16&&(u=!0,m.txt=t[4],h(()=>u=!1)),!a&&_&1&&(a=!0,m.items=t[0],h(()=>a=!1)),!o&&_&2&&(o=!0,m.total=t[1],h(()=>o=!1)),!g&&_&4&&(g=!0,m.page=t[2],h(()=>g=!1)),!f&&_&8&&(f=!0,m.pages=t[3],h(()=>f=!1)),n.$set(m)},i(t){r||(z(n.$$.fragment,t),r=!0)},o(t){E(n.$$.fragment,t),r=!1},d(t){F(n,t)}}}const nt=async({params:i,session:n,fetch:s})=>{const{id:u}=i,a=await w.get(`users/${u}`,s);if(!a.OK)return{status:a.STATUS,error:a.error};if(!n.user)return{status:302,redirect:`${C.users}/${u}/about`};const o=await G("/send",{path:"txts/users",method:"POST",data:{user:u}},s);if(!o.OK)return{status:o.STATUS,error:o.error};let{items:g,total:f,page:r,pages:p}=await w.get(`txts?id=${o.id}`);return{props:{txt:o,items:g,total:f,page:r,pages:p,user:a,authUser:n.user}}};function J(i,n,s){let{items:u=[],total:a,page:o,pages:g,txt:f,user:r,authUser:p}=n;const x=()=>{O.emit("join",f.id)},T=async({detail:e})=>{const A={txt:f.id,value:e};await w.post("txts",A).then(b=>{if(console.log(b),!b.OK){console.log("not ok - ",b);return}O.emit("txt",b)})};function S(e){i.$$.not_equal(r.username,e)&&(r.username=e,s(5,r))}function k(e){f=e,s(4,f)}function U(e){u=e,s(0,u)}function l(e){a=e,s(1,a)}function t(e){o=e,s(2,o)}function _(e){g=e,s(3,g)}const m=({detail:e})=>q(`${C.txts}/${e.id}`),K=()=>q(`${C.users}/${r.id}`);return i.$$set=e=>{"items"in e&&s(0,u=e.items),"total"in e&&s(1,a=e.total),"page"in e&&s(2,o=e.page),"pages"in e&&s(3,g=e.pages),"txt"in e&&s(4,f=e.txt),"user"in e&&s(5,r=e.user),"authUser"in e&&s(6,p=e.authUser)},[u,a,o,g,f,r,p,x,T,S,k,U,l,t,_,m,K]}class st extends B{constructor(n){super(),j(this,n,J,I,D,{items:0,total:1,page:2,pages:3,txt:4,user:5,authUser:6})}}export{st as default,nt as load};
